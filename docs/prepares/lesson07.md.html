<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>lesson07.md</title>
  <link rel="stylesheet" href="https://stackedit.io/style.css" />
</head>

<body class="stackedit">
  <div class="stackedit__left">
    <div class="stackedit__toc">
      
<ul>
<li><a href="#cse-382-lesson-7---stream-lazy-design-pattern">CSE 382 Lesson 7 - Stream (Lazy) Design Pattern</a>
<ul>
<li><a href="#part-1---streams">Part 1 - Streams</a></li>
<li><a href="#problem-set-1">Problem Set 1</a></li>
<li><a href="#part-2---stream-monad--collection">Part 2 - Stream Monad & Collection</a></li>
<li><a href="#problem-set-2">Problem Set 2</a></li>
<li><a href="#part-3---erlang-processes--streams">Part 3 - Erlang Processes & Streams</a></li>
<li><a href="#problem-set-3">Problem Set 3</a></li>
</ul>
</li>
</ul>

    </div>
  </div>
  <div class="stackedit__right">
    <div class="stackedit__html">
      <h1 id="cse-382-lesson-7---stream-lazy-design-pattern">CSE 382 Lesson 7 - Stream (Lazy) Design Pattern</h1>
<p>In this lesson we will learn about the Stream Design Pattern.  Streams are things that provide you values when you need them.  They are an example of the unfold functor pattern.  This “lazy” approach can actually save you a lot of time and memory when you only need something one at a time.</p>
<p>You can find the template for the problem sets in this lesson here: <a href="https://macbeth-byui.github.io/cse382-course/proves/prove07.erl">prove07.erl</a></p>
<h2 id="part-1---streams">Part 1 - Streams</h2>
<p>A stream provides information to us one item at a time whenever we need it.  This implies that when writing a stream, we need to consider two things:</p>
<ul>
<li>Provide the user a function to call when they are ready to get the next thing.</li>
<li>The function that we provide must be aware of what the previous thing was so it can give the next thing.</li>
</ul>
<p>Let’s look at both of these needs separately.  If we wanted to provide the user with the ability to add 1 to a number at any time, we could write a function that return a function to be called later.</p>
<blockquote>
<p><span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>p</mi><mi>e</mi><mi>c</mi><mtext>&nbsp;&nbsp;</mtext><mi>l</mi><mi>a</mi><mi>z</mi><mi>y</mi><mi mathvariant="normal">_</mi><mi>i</mi><mi>n</mi><mi>c</mi><mi>r</mi><mi mathvariant="normal">_</mi><mi>o</mi><mi>n</mi><mi>c</mi><mi>e</mi><mo>:</mo><mo>:</mo><mi>i</mi><mi>n</mi><mi>t</mi><mi>e</mi><mi>g</mi><mi>e</mi><mi>r</mi><mo>→</mo><mo stretchy="false">(</mo><mi>λ</mi><mo>:</mo><mo>:</mo><mtext>&nbsp;&nbsp;</mtext><mo>→</mo><mi>i</mi><mi>n</mi><mi>t</mi><mi>e</mi><mi>g</mi><mi>e</mi><mi>r</mi><mo stretchy="false">)</mo><mi mathvariant="normal">.</mi></mrow><annotation encoding="application/x-tex">spec ~ ~ lazy\_incr\_once :: integer \rightarrow (\lambda :: ~ ~  \rightarrow integer).</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1.00444em; vertical-align: -0.31em;"></span><span class="mord mathnormal">s</span><span class="mord mathnormal">p</span><span class="mord mathnormal">ec</span><span class="mspace nobreak">&nbsp;</span><span class="mspace nobreak">&nbsp;</span><span class="mord mathnormal" style="margin-right: 0.01968em;">l</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right: 0.03588em;">zy</span><span class="mord" style="margin-right: 0.02778em;">_</span><span class="mord mathnormal">in</span><span class="mord mathnormal" style="margin-right: 0.02778em;">cr</span><span class="mord" style="margin-right: 0.02778em;">_</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mord mathnormal">ce</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">::</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.85396em; vertical-align: -0.19444em;"></span><span class="mord mathnormal">in</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right: 0.03588em;">g</span><span class="mord mathnormal" style="margin-right: 0.02778em;">er</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">λ</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">::</span><span class="mspace nobreak">&nbsp;</span><span class="mspace nobreak">&nbsp;</span><span class="mrel">→</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal">in</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right: 0.03588em;">g</span><span class="mord mathnormal" style="margin-right: 0.02778em;">er</span><span class="mclose">)</span><span class="mord">.</span></span></span></span></span></p>
<p><span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mi>e</mi><mi>f</mi><mtext>&nbsp;&nbsp;</mtext><mi>l</mi><mi>a</mi><mi>z</mi><mi>y</mi><mi mathvariant="normal">_</mi><mi>i</mi><mi>n</mi><mi>c</mi><mi>r</mi><mi mathvariant="normal">_</mi><mi>o</mi><mi>n</mi><mi>c</mi><mi>e</mi><mo>:</mo><mo>:</mo><mi>V</mi><mi>a</mi><mi>l</mi><mi>u</mi><mi>e</mi><mo>→</mo><mo stretchy="false">(</mo><mi>λ</mi><mo>:</mo><mo>:</mo><mtext>&nbsp;&nbsp;</mtext><mo>→</mo><mi>V</mi><mi>a</mi><mi>l</mi><mi>u</mi><mi>e</mi><mo>+</mo><mn>1</mn><mo stretchy="false">)</mo><mi mathvariant="normal">.</mi></mrow><annotation encoding="application/x-tex">de\mathit{f} ~ ~ lazy\_incr\_once :: Value \rightarrow (\lambda :: ~ ~ \rightarrow Value + 1).</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1.00444em; vertical-align: -0.31em;"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathit">f</span><span class="mspace nobreak">&nbsp;</span><span class="mspace nobreak">&nbsp;</span><span class="mord mathnormal" style="margin-right: 0.01968em;">l</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right: 0.03588em;">zy</span><span class="mord" style="margin-right: 0.02778em;">_</span><span class="mord mathnormal">in</span><span class="mord mathnormal" style="margin-right: 0.02778em;">cr</span><span class="mord" style="margin-right: 0.02778em;">_</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mord mathnormal">ce</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">::</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.69444em; vertical-align: 0em;"></span><span class="mord mathnormal">Va</span><span class="mord mathnormal" style="margin-right: 0.01968em;">l</span><span class="mord mathnormal">u</span><span class="mord mathnormal">e</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">λ</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">::</span><span class="mspace nobreak">&nbsp;</span><span class="mspace nobreak">&nbsp;</span><span class="mrel">→</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.77777em; vertical-align: -0.08333em;"></span><span class="mord mathnormal">Va</span><span class="mord mathnormal" style="margin-right: 0.01968em;">l</span><span class="mord mathnormal">u</span><span class="mord mathnormal">e</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mord">.</span></span></span></span></span></p>
</blockquote>
<pre class=" language-erlang"><code class="prism  language-erlang"><span class="token function">lazy_incr_once</span><span class="token punctuation">(</span><span class="token variable">X</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token keyword">fun</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token variable">X</span> <span class="token operator">+</span> <span class="token number">1</span> <span class="token keyword">end</span><span class="token punctuation">.</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span>
    <span class="token variable">L</span> <span class="token operator">=</span> <span class="token function">lazy_incr_once</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token number">5</span> <span class="token operator">=</span> <span class="token variable">L</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token number">5</span> <span class="token operator">=</span> <span class="token variable">L</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token atom">ok</span><span class="token punctuation">.</span>
</code></pre>
<p>In the code above, we are running the function that was returned when we called <code>lazy_incr_once</code>.  Combine this concept with the desire to have the function return something based on the previous result.  In the <code>lazy_incr</code> function, we will return two things: the next value and the next function to call.  Notice that we are defining a custom data type called <code>iterator</code> which will contain both of these things.  Our ultimate goal by the next lesson is to define this as a Monad.</p>
<blockquote>
<p><span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>t</mi><mi>r</mi><mi>u</mi><mi>c</mi><mi>t</mi><mtext>&nbsp;&nbsp;</mtext><mi>i</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>a</mi><mi>t</mi><mi>o</mi><mi>r</mi><mtext>&nbsp;&nbsp;</mtext><mo stretchy="false">{</mo><mi>a</mi><mo separator="true">,</mo><msub><mi>λ</mi><mrow><mi>s</mi><mi>t</mi><mi>r</mi><mi>e</mi><mi>a</mi><mi>m</mi></mrow></msub><mo stretchy="false">}</mo><mi mathvariant="normal">.</mi></mrow><annotation encoding="application/x-tex">struct ~ ~ iterator ~ ~ \lbrace a, \lambda_{stream} \rbrace.</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal">s</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right: 0.02778em;">r</span><span class="mord mathnormal">u</span><span class="mord mathnormal">c</span><span class="mord mathnormal">t</span><span class="mspace nobreak">&nbsp;</span><span class="mspace nobreak">&nbsp;</span><span class="mord mathnormal">i</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right: 0.02778em;">er</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right: 0.02778em;">or</span><span class="mspace nobreak">&nbsp;</span><span class="mspace nobreak">&nbsp;</span><span class="mopen">{</span><span class="mord mathnormal">a</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mord mathnormal">λ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.280556em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">s</span><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">re</span><span class="mord mathnormal mtight">am</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mclose">}</span><span class="mord">.</span></span></span></span></span></p>
<p><span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>p</mi><mi>e</mi><mi>c</mi><mtext>&nbsp;&nbsp;</mtext><msub><mi>λ</mi><mrow><mi>s</mi><mi>t</mi><mi>r</mi><mi>e</mi><mi>a</mi><mi>m</mi></mrow></msub><mo>:</mo><mo>:</mo><mtext>&nbsp;&nbsp;</mtext><mo>→</mo><mi>i</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>a</mi><mi>t</mi><mi>o</mi><mi>r</mi><mi mathvariant="normal">.</mi></mrow><annotation encoding="application/x-tex">spec ~ ~ \lambda_{stream} :: ~ ~ \rightarrow iterator.</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span class="mord mathnormal">s</span><span class="mord mathnormal">p</span><span class="mord mathnormal">ec</span><span class="mspace nobreak">&nbsp;</span><span class="mspace nobreak">&nbsp;</span><span class="mord"><span class="mord mathnormal">λ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.280556em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">s</span><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">re</span><span class="mord mathnormal mtight">am</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">::</span><span class="mspace nobreak">&nbsp;</span><span class="mspace nobreak">&nbsp;</span><span class="mrel">→</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.65952em; vertical-align: 0em;"></span><span class="mord mathnormal">i</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right: 0.02778em;">er</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right: 0.02778em;">or</span><span class="mord">.</span></span></span></span></span></p>
<p><span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>p</mi><mi>e</mi><mi>c</mi><mtext>&nbsp;&nbsp;</mtext><mi>l</mi><mi>a</mi><mi>z</mi><mi>y</mi><mi mathvariant="normal">_</mi><mi>i</mi><mi>n</mi><mi>c</mi><mi>r</mi><mo>:</mo><mo>:</mo><mi>i</mi><mi>n</mi><mi>t</mi><mi>e</mi><mi>g</mi><mi>e</mi><mi>r</mi><mo>→</mo><msub><mi>λ</mi><mrow><mi>s</mi><mi>t</mi><mi>r</mi><mi>e</mi><mi>a</mi><mi>m</mi></mrow></msub><mi mathvariant="normal">.</mi></mrow><annotation encoding="application/x-tex">spec ~ ~ lazy\_incr :: integer \rightarrow \lambda_{stream}.</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1.00444em; vertical-align: -0.31em;"></span><span class="mord mathnormal">s</span><span class="mord mathnormal">p</span><span class="mord mathnormal">ec</span><span class="mspace nobreak">&nbsp;</span><span class="mspace nobreak">&nbsp;</span><span class="mord mathnormal" style="margin-right: 0.01968em;">l</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right: 0.03588em;">zy</span><span class="mord" style="margin-right: 0.02778em;">_</span><span class="mord mathnormal">in</span><span class="mord mathnormal" style="margin-right: 0.02778em;">cr</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">::</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.85396em; vertical-align: -0.19444em;"></span><span class="mord mathnormal">in</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right: 0.03588em;">g</span><span class="mord mathnormal" style="margin-right: 0.02778em;">er</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.84444em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord mathnormal">λ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.280556em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">s</span><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">re</span><span class="mord mathnormal mtight">am</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord">.</span></span></span></span></span></p>
<p><span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mi>e</mi><mi>f</mi><mtext>&nbsp;&nbsp;</mtext><mi>l</mi><mi>a</mi><mi>z</mi><mi>y</mi><mi mathvariant="normal">_</mi><mi>i</mi><mi>n</mi><mi>c</mi><mi>r</mi><mo>:</mo><mo>:</mo><mi>V</mi><mi>a</mi><mi>l</mi><mi>u</mi><mi>e</mi><mo>→</mo><mo stretchy="false">(</mo><msub><mi>λ</mi><mrow><mi>s</mi><mi>t</mi><mi>r</mi><mi>e</mi><mi>a</mi><mi>m</mi></mrow></msub><mo>:</mo><mo>:</mo><mtext>&nbsp;&nbsp;</mtext><mo>→</mo><mo stretchy="false">{</mo><mo stretchy="false">(</mo><mi>V</mi><mi>a</mi><mi>l</mi><mi>u</mi><mi>e</mi><mo>+</mo><mn>1</mn><mo stretchy="false">)</mo><mo separator="true">,</mo><mo stretchy="false">(</mo><mi>l</mi><mi>a</mi><mi>z</mi><mi>y</mi><mi mathvariant="normal">_</mi><mi>i</mi><mi>n</mi><mi>c</mi><mi>r</mi><mtext>&nbsp;&nbsp;</mtext><mo stretchy="false">(</mo><mi>V</mi><mi>a</mi><mi>l</mi><mi>u</mi><mi>e</mi><mo>+</mo><mn>1</mn><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mo stretchy="false">}</mo><mo stretchy="false">)</mo><mi mathvariant="normal">.</mi></mrow><annotation encoding="application/x-tex">de\mathit{f} ~ ~ lazy\_incr :: Value \rightarrow (\lambda_{stream} :: ~ ~ \rightarrow \lbrace (Value + 1), (lazy\_incr ~ ~ (Value + 1)) \rbrace).</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1.00444em; vertical-align: -0.31em;"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathit">f</span><span class="mspace nobreak">&nbsp;</span><span class="mspace nobreak">&nbsp;</span><span class="mord mathnormal" style="margin-right: 0.01968em;">l</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right: 0.03588em;">zy</span><span class="mord" style="margin-right: 0.02778em;">_</span><span class="mord mathnormal">in</span><span class="mord mathnormal" style="margin-right: 0.02778em;">cr</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">::</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.69444em; vertical-align: 0em;"></span><span class="mord mathnormal">Va</span><span class="mord mathnormal" style="margin-right: 0.01968em;">l</span><span class="mord mathnormal">u</span><span class="mord mathnormal">e</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">λ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.280556em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">s</span><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">re</span><span class="mord mathnormal mtight">am</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">::</span><span class="mspace nobreak">&nbsp;</span><span class="mspace nobreak">&nbsp;</span><span class="mrel">→</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">{(</span><span class="mord mathnormal">Va</span><span class="mord mathnormal" style="margin-right: 0.01968em;">l</span><span class="mord mathnormal">u</span><span class="mord mathnormal">e</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1.06em; vertical-align: -0.31em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right: 0.01968em;">l</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right: 0.03588em;">zy</span><span class="mord" style="margin-right: 0.02778em;">_</span><span class="mord mathnormal">in</span><span class="mord mathnormal" style="margin-right: 0.02778em;">cr</span><span class="mspace nobreak">&nbsp;</span><span class="mspace nobreak">&nbsp;</span><span class="mopen">(</span><span class="mord mathnormal">Va</span><span class="mord mathnormal" style="margin-right: 0.01968em;">l</span><span class="mord mathnormal">u</span><span class="mord mathnormal">e</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord">1</span><span class="mclose">))})</span><span class="mord">.</span></span></span></span></span></p>
</blockquote>
<pre class=" language-erlang"><code class="prism  language-erlang"><span class="token function">lazy_incr</span><span class="token punctuation">(</span><span class="token variable">Value</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token keyword">fun</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span><span class="token variable">Value</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token function">lazy_incr</span><span class="token punctuation">(</span><span class="token variable">Value</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span> <span class="token keyword">end</span><span class="token punctuation">.</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span>
    <span class="token variable">L</span> <span class="token operator">=</span> <span class="token function">lazy_incr</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token variable">L2</span><span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token variable">L</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token variable">L3</span><span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token variable">L2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token variable">L4</span><span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token variable">L3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token atom">ok</span><span class="token punctuation">.</span>
</code></pre>
<p>Another classic stream is the range function which will provide a sequence of numbers but only one at a time.  In this function, we will assume that the sequence will from <code>Start</code> to <code>Stop</code>, inclusive and that <code>Start &lt;= Stop</code>.  Unlike the previous example, this iterator will need to stop.  We will modify our new <code>fixed_iterator</code> to have other possible values.</p>
<blockquote>
<p><span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>t</mi><mi>r</mi><mi>u</mi><mi>c</mi><mi>t</mi><mtext>&nbsp;&nbsp;</mtext><mi>f</mi><mi>i</mi><mi>x</mi><mi>e</mi><mi>d</mi><mi mathvariant="normal">_</mi><mi>i</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>a</mi><mi>t</mi><mi>o</mi><mi>r</mi></mrow><annotation encoding="application/x-tex">struct ~ ~ \mathit{f}ixed\_iterator</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1.00444em; vertical-align: -0.31em;"></span><span class="mord mathnormal">s</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right: 0.02778em;">r</span><span class="mord mathnormal">u</span><span class="mord mathnormal">c</span><span class="mord mathnormal">t</span><span class="mspace nobreak">&nbsp;</span><span class="mspace nobreak">&nbsp;</span><span class="mord mathit">f</span><span class="mord mathnormal">i</span><span class="mord mathnormal">x</span><span class="mord mathnormal">e</span><span class="mord mathnormal">d</span><span class="mord" style="margin-right: 0.02778em;">_</span><span class="mord mathnormal">i</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right: 0.02778em;">er</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right: 0.02778em;">or</span></span></span></span></span><br>
<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mspace width="2em"></mspace><mo stretchy="false">{</mo><mi>a</mi><mo separator="true">,</mo><msub><mi>λ</mi><mrow><mi>s</mi><mi>t</mi><mi>r</mi><mi>e</mi><mi>a</mi><mi>m</mi></mrow></msub><mo stretchy="false">}</mo><mtext>&nbsp;&nbsp;</mtext><mi>o</mi><mi>r</mi></mrow><annotation encoding="application/x-tex">\kern{2em}\lbrace a, \lambda_{stream} \rbrace ~ ~ or</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mspace" style="margin-right: 2em;"></span><span class="mopen">{</span><span class="mord mathnormal">a</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mord mathnormal">λ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.280556em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">s</span><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">re</span><span class="mord mathnormal mtight">am</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mclose">}</span><span class="mspace nobreak">&nbsp;</span><span class="mspace nobreak">&nbsp;</span><span class="mord mathnormal" style="margin-right: 0.02778em;">or</span></span></span></span></span><br>
<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mspace width="2em"></mspace><mo stretchy="false">{</mo><mi>a</mi><mi>t</mi><mi>o</mi><mi>m</mi><mo stretchy="false">(</mo><mi>u</mi><mi>n</mi><mi>d</mi><mi>e</mi><mi>f</mi><mi>i</mi><mi>n</mi><mi>e</mi><mi>d</mi><mo stretchy="false">)</mo><mo separator="true">,</mo><mi>a</mi><mi>t</mi><mi>o</mi><mi>m</mi><mo stretchy="false">(</mo><mi>d</mi><mi>o</mi><mi>n</mi><mi>e</mi><mo stretchy="false">)</mo><mo stretchy="false">}</mo><mi mathvariant="normal">.</mi></mrow><annotation encoding="application/x-tex">\kern{2em}\lbrace atom(unde\mathit{f}ined), atom(done) \rbrace.</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mspace" style="margin-right: 2em;"></span><span class="mopen">{</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal">o</span><span class="mord mathnormal">m</span><span class="mopen">(</span><span class="mord mathnormal">u</span><span class="mord mathnormal">n</span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathit">f</span><span class="mord mathnormal">in</span><span class="mord mathnormal">e</span><span class="mord mathnormal">d</span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal">o</span><span class="mord mathnormal">m</span><span class="mopen">(</span><span class="mord mathnormal">d</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mord mathnormal">e</span><span class="mclose">)}</span><span class="mord">.</span></span></span></span></span></p>
<p><span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>p</mi><mi>e</mi><mi>c</mi><mtext>&nbsp;&nbsp;</mtext><msub><mi>λ</mi><mrow><mi>s</mi><mi>t</mi><mi>r</mi><mi>e</mi><mi>a</mi><mi>m</mi></mrow></msub><mo>:</mo><mo>:</mo><mtext>&nbsp;&nbsp;</mtext><mo>→</mo><mi>f</mi><mi>i</mi><mi>x</mi><mi>e</mi><mi>d</mi><mi mathvariant="normal">_</mi><mi>i</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>a</mi><mi>t</mi><mi>o</mi><mi>r</mi><mi mathvariant="normal">.</mi></mrow><annotation encoding="application/x-tex">spec ~ ~ \lambda_{stream} :: ~ ~ \rightarrow \mathit{f}ixed\_iterator.</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span class="mord mathnormal">s</span><span class="mord mathnormal">p</span><span class="mord mathnormal">ec</span><span class="mspace nobreak">&nbsp;</span><span class="mspace nobreak">&nbsp;</span><span class="mord"><span class="mord mathnormal">λ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.280556em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">s</span><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">re</span><span class="mord mathnormal mtight">am</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">::</span><span class="mspace nobreak">&nbsp;</span><span class="mspace nobreak">&nbsp;</span><span class="mrel">→</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1.00444em; vertical-align: -0.31em;"></span><span class="mord mathit">f</span><span class="mord mathnormal">i</span><span class="mord mathnormal">x</span><span class="mord mathnormal">e</span><span class="mord mathnormal">d</span><span class="mord" style="margin-right: 0.02778em;">_</span><span class="mord mathnormal">i</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right: 0.02778em;">er</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right: 0.02778em;">or</span><span class="mord">.</span></span></span></span></span></p>
<p><span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>p</mi><mi>e</mi><mi>c</mi><mtext>&nbsp;&nbsp;</mtext><mi>r</mi><mi>a</mi><mi>n</mi><mi>g</mi><mi>e</mi><mo>:</mo><mo>:</mo><mi>i</mi><mi>n</mi><mi>t</mi><mi>e</mi><mi>g</mi><mi>e</mi><mi>r</mi><mtext>&nbsp;&nbsp;</mtext><mi>i</mi><mi>n</mi><mi>t</mi><mi>e</mi><mi>g</mi><mi>e</mi><mi>r</mi><mo>→</mo><msub><mi>λ</mi><mrow><mi>s</mi><mi>t</mi><mi>r</mi><mi>e</mi><mi>a</mi><mi>m</mi></mrow></msub><mi mathvariant="normal">.</mi></mrow><annotation encoding="application/x-tex">spec ~ ~ range :: integer ~ ~ integer \rightarrow \lambda_{stream}.</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.625em; vertical-align: -0.19444em;"></span><span class="mord mathnormal">s</span><span class="mord mathnormal">p</span><span class="mord mathnormal">ec</span><span class="mspace nobreak">&nbsp;</span><span class="mspace nobreak">&nbsp;</span><span class="mord mathnormal" style="margin-right: 0.02778em;">r</span><span class="mord mathnormal">an</span><span class="mord mathnormal" style="margin-right: 0.03588em;">g</span><span class="mord mathnormal">e</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">::</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.85396em; vertical-align: -0.19444em;"></span><span class="mord mathnormal">in</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right: 0.03588em;">g</span><span class="mord mathnormal" style="margin-right: 0.02778em;">er</span><span class="mspace nobreak">&nbsp;</span><span class="mspace nobreak">&nbsp;</span><span class="mord mathnormal">in</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right: 0.03588em;">g</span><span class="mord mathnormal" style="margin-right: 0.02778em;">er</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.84444em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord mathnormal">λ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.280556em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">s</span><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">re</span><span class="mord mathnormal mtight">am</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord">.</span></span></span></span></span></p>
<p><span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mi>e</mi><mi>f</mi><mtext>&nbsp;&nbsp;</mtext><mi>r</mi><mi>a</mi><mi>n</mi><mi>g</mi><mi>e</mi><mo>:</mo><mo>:</mo><mi>S</mi><mi>t</mi><mi>a</mi><mi>r</mi><mi>t</mi><mtext>&nbsp;&nbsp;</mtext><mi>S</mi><mi>t</mi><mi>o</mi><mi>p</mi><mo>→</mo><mo stretchy="false">(</mo><msub><mi>λ</mi><mrow><mi>s</mi><mi>t</mi><mi>r</mi><mi>e</mi><mi>a</mi><mi>m</mi></mrow></msub><mo>:</mo><mo>:</mo><mtext>&nbsp;&nbsp;</mtext><mo>→</mo><mo stretchy="false">{</mo><mi>S</mi><mi>t</mi><mi>a</mi><mi>r</mi><mi>t</mi><mo separator="true">,</mo><mo stretchy="false">(</mo><mi>r</mi><mi>a</mi><mi>n</mi><mi>g</mi><mi>e</mi><mtext>&nbsp;&nbsp;</mtext><mo stretchy="false">(</mo><mi>S</mi><mi>t</mi><mi>a</mi><mi>r</mi><mi>t</mi><mo>+</mo><mn>1</mn><mo stretchy="false">)</mo><mo separator="true">,</mo><mi>S</mi><mi>t</mi><mi>o</mi><mi>p</mi><mo stretchy="false">)</mo><mo stretchy="false">}</mo><mo stretchy="false">)</mo><mtext>&nbsp;&nbsp;when&nbsp;&nbsp;</mtext><mi>S</mi><mi>t</mi><mi>a</mi><mi>r</mi><mi>t</mi><mo>≤</mo><mi>S</mi><mi>t</mi><mi>o</mi><mi>p</mi><mo separator="true">;</mo></mrow><annotation encoding="application/x-tex">de\mathit{f} ~ ~ range :: Start ~ ~ Stop \rightarrow (\lambda_{stream} :: ~ ~ \rightarrow \lbrace Start, (range ~ ~ (Start+1), Stop) \rbrace ) ~ ~ \text{when} ~ ~ Start \leq Stop;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathit">f</span><span class="mspace nobreak">&nbsp;</span><span class="mspace nobreak">&nbsp;</span><span class="mord mathnormal" style="margin-right: 0.02778em;">r</span><span class="mord mathnormal">an</span><span class="mord mathnormal" style="margin-right: 0.03588em;">g</span><span class="mord mathnormal">e</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">::</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.87777em; vertical-align: -0.19444em;"></span><span class="mord mathnormal">St</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right: 0.02778em;">r</span><span class="mord mathnormal">t</span><span class="mspace nobreak">&nbsp;</span><span class="mspace nobreak">&nbsp;</span><span class="mord mathnormal">St</span><span class="mord mathnormal">o</span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">λ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.280556em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">s</span><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">re</span><span class="mord mathnormal mtight">am</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">::</span><span class="mspace nobreak">&nbsp;</span><span class="mspace nobreak">&nbsp;</span><span class="mrel">→</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">{</span><span class="mord mathnormal">St</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right: 0.02778em;">r</span><span class="mord mathnormal">t</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right: 0.02778em;">r</span><span class="mord mathnormal">an</span><span class="mord mathnormal" style="margin-right: 0.03588em;">g</span><span class="mord mathnormal">e</span><span class="mspace nobreak">&nbsp;</span><span class="mspace nobreak">&nbsp;</span><span class="mopen">(</span><span class="mord mathnormal">St</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right: 0.02778em;">r</span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathnormal">St</span><span class="mord mathnormal">o</span><span class="mord mathnormal">p</span><span class="mclose">)})</span><span class="mspace nobreak">&nbsp;</span><span class="mspace nobreak">&nbsp;</span><span class="mord text"><span class="mord">when</span></span><span class="mspace nobreak">&nbsp;</span><span class="mspace nobreak">&nbsp;</span><span class="mord mathnormal">St</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right: 0.02778em;">r</span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.87777em; vertical-align: -0.19444em;"></span><span class="mord mathnormal">St</span><span class="mord mathnormal">o</span><span class="mord mathnormal">p</span><span class="mpunct">;</span></span></span></span></span></p>
<p><span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mi>e</mi><mi>f</mi><mtext>&nbsp;&nbsp;</mtext><mi>r</mi><mi>a</mi><mi>n</mi><mi>g</mi><mi>e</mi><mo>:</mo><mo>:</mo><mi>S</mi><mi>t</mi><mi>a</mi><mi>r</mi><mi>t</mi><mtext>&nbsp;&nbsp;</mtext><mi>S</mi><mi>t</mi><mi>o</mi><mi>p</mi><mo>→</mo><mo stretchy="false">(</mo><msub><mi>λ</mi><mrow><mi>s</mi><mi>t</mi><mi>r</mi><mi>e</mi><mi>a</mi><mi>m</mi></mrow></msub><mo>:</mo><mo>:</mo><mtext>&nbsp;&nbsp;</mtext><mo>→</mo><mo stretchy="false">{</mo><mi>u</mi><mi>n</mi><mi>d</mi><mi>e</mi><mi>f</mi><mi>i</mi><mi>n</mi><mi>e</mi><mi>d</mi><mo separator="true">,</mo><mi>d</mi><mi>o</mi><mi>n</mi><mi>e</mi><mo stretchy="false">}</mo><mo stretchy="false">)</mo><mi mathvariant="normal">.</mi></mrow><annotation encoding="application/x-tex">de\mathit{f} ~ ~ range :: Start ~ ~ Stop \rightarrow (\lambda_{stream} :: ~ ~ \rightarrow \lbrace undefined, done \rbrace).</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathit">f</span><span class="mspace nobreak">&nbsp;</span><span class="mspace nobreak">&nbsp;</span><span class="mord mathnormal" style="margin-right: 0.02778em;">r</span><span class="mord mathnormal">an</span><span class="mord mathnormal" style="margin-right: 0.03588em;">g</span><span class="mord mathnormal">e</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">::</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.87777em; vertical-align: -0.19444em;"></span><span class="mord mathnormal">St</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right: 0.02778em;">r</span><span class="mord mathnormal">t</span><span class="mspace nobreak">&nbsp;</span><span class="mspace nobreak">&nbsp;</span><span class="mord mathnormal">St</span><span class="mord mathnormal">o</span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">λ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.280556em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">s</span><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">re</span><span class="mord mathnormal mtight">am</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">::</span><span class="mspace nobreak">&nbsp;</span><span class="mspace nobreak">&nbsp;</span><span class="mrel">→</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">{</span><span class="mord mathnormal">u</span><span class="mord mathnormal">n</span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right: 0.10764em;">f</span><span class="mord mathnormal">in</span><span class="mord mathnormal">e</span><span class="mord mathnormal">d</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mord mathnormal">e</span><span class="mclose">})</span><span class="mord">.</span></span></span></span></span></p>
</blockquote>
<p>The erlang code is given below:</p>
<pre class=" language-erlang"><code class="prism  language-erlang"><span class="token function">range</span><span class="token punctuation">(</span><span class="token variable">Start</span><span class="token punctuation">,</span> <span class="token variable">Stop</span><span class="token punctuation">)</span> <span class="token keyword">when</span> <span class="token variable">Start</span> <span class="token operator">=</span><span class="token operator">&lt;</span> <span class="token variable">Stop</span> <span class="token operator">-</span><span class="token operator">&gt;</span>
	<span class="token keyword">fun</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span><span class="token variable">Start</span><span class="token punctuation">,</span> <span class="token function">range</span><span class="token punctuation">(</span><span class="token variable">Start</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token variable">Stop</span><span class="token punctuation">)</span><span class="token punctuation">}</span> <span class="token keyword">end</span><span class="token punctuation">;</span>
<span class="token function">range</span><span class="token punctuation">(</span><span class="token variable">_Start</span><span class="token punctuation">,</span> <span class="token variable">_Stop</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span>
	<span class="token keyword">fun</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span><span class="token atom">undefined</span><span class="token punctuation">,</span> <span class="token atom">done</span><span class="token punctuation">}</span> <span class="token keyword">end</span><span class="token punctuation">.</span>
</code></pre>
<p>We can simplify the above code by moving the guards into the anonymous function as shown below:</p>
<pre class=" language-erlang"><code class="prism  language-erlang"><span class="token function">range</span><span class="token punctuation">(</span><span class="token variable">Start</span><span class="token punctuation">,</span> <span class="token variable">Stop</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span>
	<span class="token keyword">fun</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">when</span> <span class="token variable">Start</span> <span class="token operator">=</span><span class="token operator">&lt;</span> <span class="token variable">Stop</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span><span class="token variable">Start</span><span class="token punctuation">,</span> <span class="token function">range</span><span class="token punctuation">(</span><span class="token variable">Start</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token variable">Stop</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
		<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span><span class="token atom">undefined</span><span class="token punctuation">,</span> <span class="token atom">done</span><span class="token punctuation">}</span> <span class="token keyword">end</span><span class="token punctuation">.</span>
</code></pre>
<p>An example of the test code using the <code>range</code> function is given below.  Notice that the value of <code>{undefined, done}</code> is returned when the stream is completed.</p>
<pre class=" language-erlang"><code class="prism  language-erlang"><span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span>
	<span class="token variable">Stream1</span> <span class="token operator">=</span> <span class="token function">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token variable">Stream2</span><span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token variable">Stream1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token punctuation">{</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token variable">Stream3</span><span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token variable">Stream2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token punctuation">{</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token variable">Stream4</span><span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token variable">Stream3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token punctuation">{</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token variable">Stream5</span><span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token variable">Stream4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token punctuation">{</span><span class="token atom">undefined</span><span class="token punctuation">,</span> <span class="token atom">done</span><span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token variable">Stream5</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token atom">ok</span><span class="token punctuation">.</span>
</code></pre>
<h2 id="problem-set-1">Problem Set 1</h2>
<ol>
<li>Modify the <code>range</code> function to take a third parameter called <code>step</code>.  You should increase the sequence by the amount of <code>step</code>.  If the <code>step</code> is negative, then create a decreasing sequence.  If the <code>step</code> is 0, then the <code>done</code> state should occur immediately.  Test code is provided to test your stream.</li>
<li>Create a new stream called <code>words</code> which will split text by spaces into sub-strings   Each time the stream is called, it should return back the next string.  For example, if the text was “The cow jumped over the moon.”, then the stream would first return “The”, then “cow”, then “jumped”, and so forth.  Use the <code>fixed_iterator</code> Monad type described above.  You are provided a function called <code>first_word</code> which returns a tuple in the format <code>{Word, Rest}</code> where <code>Word</code> is the first word and <code>Rest</code> is the remaining text (just like working with values in a list).  Test code is provided to test your stream.</li>
</ol>
<h2 id="part-2---stream-monad--collection">Part 2 - Stream Monad &amp; Collection</h2>
<p>In the previous section we created a <code>fixed_iterator</code> Monad that the <code>range</code> function supported.  To complete the Monad definition, we need a type constructor (or unit function) and a bind function.  Since the type constructor will need to create a stream that hasn’t started yet, we will modify our specification for the Monad Type we had earlier (the second condition in the struct is new):</p>
<blockquote>
<p><span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>t</mi><mi>r</mi><mi>u</mi><mi>c</mi><mi>t</mi><mtext>&nbsp;&nbsp;</mtext><mi>f</mi><mi>i</mi><mi>x</mi><mi>e</mi><mi>d</mi><mi mathvariant="normal">_</mi><mi>i</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>a</mi><mi>t</mi><mi>o</mi><mi>r</mi></mrow><annotation encoding="application/x-tex">struct ~ ~ \mathit{f}ixed\_iterator</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1.00444em; vertical-align: -0.31em;"></span><span class="mord mathnormal">s</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right: 0.02778em;">r</span><span class="mord mathnormal">u</span><span class="mord mathnormal">c</span><span class="mord mathnormal">t</span><span class="mspace nobreak">&nbsp;</span><span class="mspace nobreak">&nbsp;</span><span class="mord mathit">f</span><span class="mord mathnormal">i</span><span class="mord mathnormal">x</span><span class="mord mathnormal">e</span><span class="mord mathnormal">d</span><span class="mord" style="margin-right: 0.02778em;">_</span><span class="mord mathnormal">i</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right: 0.02778em;">er</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right: 0.02778em;">or</span></span></span></span></span><br>
<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mspace width="2em"></mspace><mo stretchy="false">{</mo><mi>a</mi><mo separator="true">,</mo><msub><mi>λ</mi><mrow><mi>s</mi><mi>t</mi><mi>r</mi><mi>e</mi><mi>a</mi><mi>m</mi></mrow></msub><mo stretchy="false">}</mo><mtext>&nbsp;&nbsp;</mtext><mi>o</mi><mi>r</mi></mrow><annotation encoding="application/x-tex">\kern{2em}\lbrace a, \lambda_{stream} \rbrace ~ ~ or</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mspace" style="margin-right: 2em;"></span><span class="mopen">{</span><span class="mord mathnormal">a</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mord mathnormal">λ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.280556em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">s</span><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">re</span><span class="mord mathnormal mtight">am</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mclose">}</span><span class="mspace nobreak">&nbsp;</span><span class="mspace nobreak">&nbsp;</span><span class="mord mathnormal" style="margin-right: 0.02778em;">or</span></span></span></span></span><br>
<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mspace width="2em"></mspace><mo stretchy="false">{</mo><mi>a</mi><mi>t</mi><mi>o</mi><mi>m</mi><mo stretchy="false">(</mo><mi>u</mi><mi>n</mi><mi>d</mi><mi>e</mi><mi>f</mi><mi>i</mi><mi>n</mi><mi>e</mi><mi>d</mi><mo stretchy="false">)</mo><mo separator="true">,</mo><msub><mi>λ</mi><mrow><mi>s</mi><mi>t</mi><mi>r</mi><mi>e</mi><mi>a</mi><mi>m</mi></mrow></msub><mo stretchy="false">}</mo><mtext>&nbsp;&nbsp;</mtext><mi>o</mi><mi>r</mi></mrow><annotation encoding="application/x-tex">\kern{2em}\lbrace atom(unde\mathit{f}ined), \lambda_{stream} \rbrace ~ ~ or</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mspace" style="margin-right: 2em;"></span><span class="mopen">{</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal">o</span><span class="mord mathnormal">m</span><span class="mopen">(</span><span class="mord mathnormal">u</span><span class="mord mathnormal">n</span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathit">f</span><span class="mord mathnormal">in</span><span class="mord mathnormal">e</span><span class="mord mathnormal">d</span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mord mathnormal">λ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.280556em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">s</span><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">re</span><span class="mord mathnormal mtight">am</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mclose">}</span><span class="mspace nobreak">&nbsp;</span><span class="mspace nobreak">&nbsp;</span><span class="mord mathnormal" style="margin-right: 0.02778em;">or</span></span></span></span></span><br>
<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mspace width="2em"></mspace><mo stretchy="false">{</mo><mi>a</mi><mi>t</mi><mi>o</mi><mi>m</mi><mo stretchy="false">(</mo><mi>u</mi><mi>n</mi><mi>d</mi><mi>e</mi><mi>f</mi><mi>i</mi><mi>n</mi><mi>e</mi><mi>d</mi><mo stretchy="false">)</mo><mo separator="true">,</mo><mi>a</mi><mi>t</mi><mi>o</mi><mi>m</mi><mo stretchy="false">(</mo><mi>d</mi><mi>o</mi><mi>n</mi><mi>e</mi><mo stretchy="false">)</mo><mo stretchy="false">}</mo><mi mathvariant="normal">.</mi></mrow><annotation encoding="application/x-tex">\kern{2em}\lbrace atom(unde\mathit{f}ined), atom(done) \rbrace.</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mspace" style="margin-right: 2em;"></span><span class="mopen">{</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal">o</span><span class="mord mathnormal">m</span><span class="mopen">(</span><span class="mord mathnormal">u</span><span class="mord mathnormal">n</span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathit">f</span><span class="mord mathnormal">in</span><span class="mord mathnormal">e</span><span class="mord mathnormal">d</span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal">o</span><span class="mord mathnormal">m</span><span class="mopen">(</span><span class="mord mathnormal">d</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mord mathnormal">e</span><span class="mclose">)}</span><span class="mord">.</span></span></span></span></span></p>
<p><span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>p</mi><mi>e</mi><mi>c</mi><mtext>&nbsp;&nbsp;</mtext><msub><mi>λ</mi><mrow><mi>s</mi><mi>t</mi><mi>r</mi><mi>e</mi><mi>a</mi><mi>m</mi></mrow></msub><mo>:</mo><mo>:</mo><mtext>&nbsp;&nbsp;</mtext><mo>→</mo><mi>f</mi><mi>i</mi><mi>x</mi><mi>e</mi><mi>d</mi><mi mathvariant="normal">_</mi><mi>i</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>a</mi><mi>t</mi><mi>o</mi><mi>r</mi><mi mathvariant="normal">.</mi></mrow><annotation encoding="application/x-tex">spec ~ ~ \lambda_{stream} :: ~ ~ \rightarrow \mathit{f}ixed\_iterator.</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span class="mord mathnormal">s</span><span class="mord mathnormal">p</span><span class="mord mathnormal">ec</span><span class="mspace nobreak">&nbsp;</span><span class="mspace nobreak">&nbsp;</span><span class="mord"><span class="mord mathnormal">λ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.280556em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">s</span><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">re</span><span class="mord mathnormal mtight">am</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">::</span><span class="mspace nobreak">&nbsp;</span><span class="mspace nobreak">&nbsp;</span><span class="mrel">→</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1.00444em; vertical-align: -0.31em;"></span><span class="mord mathit">f</span><span class="mord mathnormal">i</span><span class="mord mathnormal">x</span><span class="mord mathnormal">e</span><span class="mord mathnormal">d</span><span class="mord" style="margin-right: 0.02778em;">_</span><span class="mord mathnormal">i</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right: 0.02778em;">er</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right: 0.02778em;">or</span><span class="mord">.</span></span></span></span></span></p>
</blockquote>
<p>The type constructor should be used to create the iterator the first time.  We will call our type constructor <code>iter</code>.  The <code>iter</code> will take as an input a <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>λ</mi><mrow><mi>s</mi><mi>t</mi><mi>r</mi><mi>e</mi><mi>a</mi><mi>m</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\lambda_{stream}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.84444em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord mathnormal">λ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.280556em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">s</span><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">re</span><span class="mord mathnormal mtight">am</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span> function (the function that is returned by our <code>range</code> function or any other stream).  The <code>iter</code> will produce the <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">{</mo><mi>a</mi><mi>t</mi><mi>o</mi><mi>m</mi><mo stretchy="false">(</mo><mi>u</mi><mi>n</mi><mi>d</mi><mi>e</mi><mi>f</mi><mi>i</mi><mi>n</mi><mi>e</mi><mi>d</mi><mo stretchy="false">)</mo><mo separator="true">,</mo><msub><mi>λ</mi><mrow><mi>n</mi><mi>e</mi><mi>x</mi><mi>t</mi></mrow></msub><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">\lbrace atom(unde\mathit{f}ined), \lambda_{next} \rbrace</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">{</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal">o</span><span class="mord mathnormal">m</span><span class="mopen">(</span><span class="mord mathnormal">u</span><span class="mord mathnormal">n</span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathit">f</span><span class="mord mathnormal">in</span><span class="mord mathnormal">e</span><span class="mord mathnormal">d</span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mord mathnormal">λ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.280556em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight">x</span><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mclose">}</span></span></span></span></span>.  This is the state of our iterator before we actually start the iteration.</p>
<blockquote>
<p><span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>p</mi><mi>e</mi><mi>c</mi><mtext>&nbsp;&nbsp;</mtext><mi>i</mi><mi>t</mi><mi>e</mi><mi>r</mi><mo>:</mo><mo>:</mo><msub><mi>λ</mi><mrow><mi>s</mi><mi>t</mi><mi>r</mi><mi>e</mi><mi>a</mi><mi>m</mi></mrow></msub><mo>→</mo><mi>f</mi><mi>i</mi><mi>x</mi><mi>e</mi><mi>d</mi><mi mathvariant="normal">_</mi><mi>i</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>a</mi><mi>t</mi><mi>o</mi><mi>r</mi><mi mathvariant="normal">.</mi></mrow><annotation encoding="application/x-tex">spec ~ ~ iter :: \lambda_{stream} \rightarrow \mathit{f}ixed\_iterator.</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.85396em; vertical-align: -0.19444em;"></span><span class="mord mathnormal">s</span><span class="mord mathnormal">p</span><span class="mord mathnormal">ec</span><span class="mspace nobreak">&nbsp;</span><span class="mspace nobreak">&nbsp;</span><span class="mord mathnormal">i</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right: 0.02778em;">er</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">::</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.84444em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord mathnormal">λ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.280556em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">s</span><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">re</span><span class="mord mathnormal mtight">am</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1.00444em; vertical-align: -0.31em;"></span><span class="mord mathit">f</span><span class="mord mathnormal">i</span><span class="mord mathnormal">x</span><span class="mord mathnormal">e</span><span class="mord mathnormal">d</span><span class="mord" style="margin-right: 0.02778em;">_</span><span class="mord mathnormal">i</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right: 0.02778em;">er</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right: 0.02778em;">or</span><span class="mord">.</span></span></span></span></span></p>
<p><span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mi>e</mi><mi>f</mi><mtext>&nbsp;&nbsp;</mtext><mi>i</mi><mi>t</mi><mi>e</mi><mi>r</mi><mo>:</mo><mo>:</mo><msub><mi>λ</mi><mrow><mi>s</mi><mi>t</mi><mi>r</mi><mi>e</mi><mi>a</mi><mi>m</mi></mrow></msub><mo>→</mo><mo stretchy="false">{</mo><mi>u</mi><mi>n</mi><mi>d</mi><mi>e</mi><mi>f</mi><mi>i</mi><mi>n</mi><mi>e</mi><mi>d</mi><mo separator="true">,</mo><msub><mi>λ</mi><mrow><mi>s</mi><mi>t</mi><mi>r</mi><mi>e</mi><mi>a</mi><mi>m</mi></mrow></msub><mo stretchy="false">}</mo><mi mathvariant="normal">.</mi></mrow><annotation encoding="application/x-tex">de\mathit{f} ~ ~ iter :: \lambda_{stream} \rightarrow \lbrace unde\mathit{f}ined, \lambda_{stream} \rbrace.</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathit">f</span><span class="mspace nobreak">&nbsp;</span><span class="mspace nobreak">&nbsp;</span><span class="mord mathnormal">i</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right: 0.02778em;">er</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">::</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.84444em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord mathnormal">λ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.280556em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">s</span><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">re</span><span class="mord mathnormal mtight">am</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">{</span><span class="mord mathnormal">u</span><span class="mord mathnormal">n</span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathit">f</span><span class="mord mathnormal">in</span><span class="mord mathnormal">e</span><span class="mord mathnormal">d</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mord mathnormal">λ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.280556em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">s</span><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">re</span><span class="mord mathnormal mtight">am</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mclose">}</span><span class="mord">.</span></span></span></span></span></p>
</blockquote>
<p>The bind should allow us to take our <code>fixed_iterator</code> (the Monad type returned by the <code>iter</code> function) and pass it to our stream function which will return an updated <code>fixed_iterator</code>.  Remember that our stream function is always regenerated and has no input parameters.  The next function is re-created each time with the next value built-into the function.  We will call our bind function <code>next</code> and it will be responsible for getting the next stream iteration.  Unlike previous bind functions we have used, this bind will not take a function parameter because it is applied only to our <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>λ</mi><mrow><mi>s</mi><mi>t</mi><mi>r</mi><mi>e</mi><mi>a</mi><mi>m</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\lambda_{stream}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.84444em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord mathnormal">λ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.280556em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">s</span><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">re</span><span class="mord mathnormal mtight">am</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span>.</p>
<blockquote>
<p><span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>p</mi><mi>e</mi><mi>c</mi><mtext>&nbsp;&nbsp;</mtext><mi>n</mi><mi>e</mi><mi>x</mi><mi>t</mi><mo>:</mo><mo>:</mo><mi>f</mi><mi>i</mi><mi>x</mi><mi>e</mi><mi>d</mi><mi mathvariant="normal">_</mi><mi>i</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>a</mi><mi>t</mi><mi>o</mi><mi>r</mi><mo>→</mo><mi>f</mi><mi>i</mi><mi>x</mi><mi>e</mi><mi>d</mi><mi mathvariant="normal">_</mi><mi>i</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>a</mi><mi>t</mi><mi>o</mi><mi>r</mi><mi mathvariant="normal">.</mi></mrow><annotation encoding="application/x-tex">spec ~ ~ next :: \mathit{f}ixed\_iterator \rightarrow \mathit{f}ixed\_iterator.</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.80952em; vertical-align: -0.19444em;"></span><span class="mord mathnormal">s</span><span class="mord mathnormal">p</span><span class="mord mathnormal">ec</span><span class="mspace nobreak">&nbsp;</span><span class="mspace nobreak">&nbsp;</span><span class="mord mathnormal">n</span><span class="mord mathnormal">e</span><span class="mord mathnormal">x</span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">::</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1.00444em; vertical-align: -0.31em;"></span><span class="mord mathit">f</span><span class="mord mathnormal">i</span><span class="mord mathnormal">x</span><span class="mord mathnormal">e</span><span class="mord mathnormal">d</span><span class="mord" style="margin-right: 0.02778em;">_</span><span class="mord mathnormal">i</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right: 0.02778em;">er</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right: 0.02778em;">or</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1.00444em; vertical-align: -0.31em;"></span><span class="mord mathit">f</span><span class="mord mathnormal">i</span><span class="mord mathnormal">x</span><span class="mord mathnormal">e</span><span class="mord mathnormal">d</span><span class="mord" style="margin-right: 0.02778em;">_</span><span class="mord mathnormal">i</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right: 0.02778em;">er</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right: 0.02778em;">or</span><span class="mord">.</span></span></span></span></span></p>
<p><span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mi>e</mi><mi>f</mi><mtext>&nbsp;&nbsp;</mtext><mi>n</mi><mi>e</mi><mi>x</mi><mi>t</mi><mo>:</mo><mo>:</mo><mo stretchy="false">{</mo><mi>V</mi><mi>a</mi><mi>l</mi><mi>u</mi><mi>e</mi><mo separator="true">,</mo><mi>d</mi><mi>o</mi><mi>n</mi><mi>e</mi><mo stretchy="false">}</mo><mo>→</mo><mo stretchy="false">{</mo><mi>u</mi><mi>n</mi><mi>d</mi><mi>e</mi><mi>f</mi><mi>i</mi><mi>n</mi><mi>e</mi><mi>d</mi><mo separator="true">,</mo><mi>d</mi><mi>o</mi><mi>n</mi><mi>e</mi><mo stretchy="false">}</mo><mo separator="true">;</mo></mrow><annotation encoding="application/x-tex">de\mathit{f} ~ ~ next :: \lbrace Value, done \rbrace \rightarrow \lbrace unde\mathit{f}ined, done \rbrace;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathit">f</span><span class="mspace nobreak">&nbsp;</span><span class="mspace nobreak">&nbsp;</span><span class="mord mathnormal">n</span><span class="mord mathnormal">e</span><span class="mord mathnormal">x</span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">::</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">{</span><span class="mord mathnormal">Va</span><span class="mord mathnormal" style="margin-right: 0.01968em;">l</span><span class="mord mathnormal">u</span><span class="mord mathnormal">e</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mord mathnormal">e</span><span class="mclose">}</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">{</span><span class="mord mathnormal">u</span><span class="mord mathnormal">n</span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathit">f</span><span class="mord mathnormal">in</span><span class="mord mathnormal">e</span><span class="mord mathnormal">d</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mord mathnormal">e</span><span class="mclose">}</span><span class="mpunct">;</span></span></span></span></span></p>
<p><span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mi>e</mi><mi>f</mi><mtext>&nbsp;&nbsp;</mtext><mi>n</mi><mi>e</mi><mi>x</mi><mi>t</mi><mo>:</mo><mo>:</mo><mo stretchy="false">{</mo><mi>V</mi><mi>a</mi><mi>l</mi><mi>u</mi><mi>e</mi><mo separator="true">,</mo><msub><mi>λ</mi><mrow><mi>s</mi><mi>t</mi><mi>r</mi><mi>e</mi><mi>a</mi><mi>m</mi></mrow></msub><mo stretchy="false">}</mo><mo>→</mo><mo stretchy="false">(</mo><msub><mi>λ</mi><mrow><mi>s</mi><mi>t</mi><mi>r</mi><mi>e</mi><mi>a</mi><mi>m</mi></mrow></msub><mo stretchy="false">)</mo><mi mathvariant="normal">.</mi></mrow><annotation encoding="application/x-tex">de\mathit{f} ~ ~ next :: \lbrace Value, \lambda_{stream} \rbrace \rightarrow (\lambda_{stream}).</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathit">f</span><span class="mspace nobreak">&nbsp;</span><span class="mspace nobreak">&nbsp;</span><span class="mord mathnormal">n</span><span class="mord mathnormal">e</span><span class="mord mathnormal">x</span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">::</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">{</span><span class="mord mathnormal">Va</span><span class="mord mathnormal" style="margin-right: 0.01968em;">l</span><span class="mord mathnormal">u</span><span class="mord mathnormal">e</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mord mathnormal">λ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.280556em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">s</span><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">re</span><span class="mord mathnormal mtight">am</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mclose">}</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">λ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.280556em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">s</span><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">re</span><span class="mord mathnormal mtight">am</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mclose">)</span><span class="mord">.</span></span></span></span></span></p>
</blockquote>
<p>Using these specifications and definitions, we can complete the <code>fixed_iterator</code> Monad along with helper functions (<code>value</code> and <code>lambda</code>) to access both parts of our Monad type.</p>
<pre class=" language-erlang"><code class="prism  language-erlang"><span class="token function">iter</span><span class="token punctuation">(</span><span class="token variable">Stream</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span><span class="token atom">undefined</span><span class="token punctuation">,</span> <span class="token variable">Stream</span><span class="token punctuation">}</span><span class="token punctuation">.</span>

<span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token variable">_Value</span><span class="token punctuation">,</span><span class="token atom">done</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span><span class="token atom">undefined</span><span class="token punctuation">,</span> <span class="token atom">done</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token variable">_Value</span><span class="token punctuation">,</span><span class="token variable">Lambda</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token variable">Lambda</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>

<span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token variable">Value</span><span class="token punctuation">,</span><span class="token variable">_Lambda</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token variable">Value</span><span class="token punctuation">.</span>
<span class="token function">lambda</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token variable">_Value</span><span class="token punctuation">,</span><span class="token variable">Lambda</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token variable">Lambda</span><span class="token punctuation">.</span>
</code></pre>
<p>We can use our new functions and show that calling our bind function <code>next</code> will result in <code>undefined</code> if we complete our iterator.</p>
<pre class=" language-erlang"><code class="prism  language-erlang"><span class="token variable">Next1</span> <span class="token operator">=</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token function">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token atom">io</span><span class="token punctuation">:</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"~p~n"</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token variable">Next1</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment">% Print 1</span>
<span class="token variable">Next2</span> <span class="token operator">=</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token variable">Next1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token atom">io</span><span class="token punctuation">:</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"~p~n"</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token variable">Next3</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment">% Print 2</span>
<span class="token variable">Next3</span> <span class="token operator">=</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token variable">Next2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token atom">io</span><span class="token punctuation">:</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"~p~n"</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token variable">Next3</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment">% Print 3</span>
<span class="token variable">Next4</span> <span class="token operator">=</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token variable">Next3</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token atom">io</span><span class="token punctuation">:</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"~p~n"</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token variable">Next4</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment">% Print 4</span>
<span class="token variable">Next5</span> <span class="token operator">=</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token variable">Next4</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token atom">io</span><span class="token punctuation">:</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"~p~n"</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token variable">Next5</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment">% Print undefined</span>
<span class="token variable">Next6</span> <span class="token operator">=</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token variable">Next5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token atom">io</span><span class="token punctuation">:</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"~p~n"</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token variable">Next6</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment">% Print undefined</span>
</code></pre>
<p>A common function that is implemented when lazy streams are supported is the <code>collect</code>.  The <code>collect</code> function will undo the “laziness” of our data structure by iterating through the entire <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>λ</mi><mrow><mi>s</mi><mi>t</mi><mi>r</mi><mi>e</mi><mi>a</mi><mi>m</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\lambda_{stream}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.84444em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord mathnormal">λ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.280556em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">s</span><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">re</span><span class="mord mathnormal mtight">am</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span> and put all the results in order into a traditional list.</p>
<p>The specification for the <code>collect</code> is given below:</p>
<blockquote>
<p><span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>p</mi><mi>e</mi><mi>c</mi><mtext>&nbsp;&nbsp;</mtext><mi>c</mi><mi>o</mi><mi>l</mi><mi>l</mi><mi>e</mi><mi>c</mi><mi>t</mi><mo>:</mo><mo>:</mo><msub><mi>λ</mi><mrow><mi>s</mi><mi>t</mi><mi>r</mi><mi>e</mi><mi>a</mi><mi>m</mi></mrow></msub><mo>→</mo><mo stretchy="false">[</mo><mi>a</mi><mo stretchy="false">]</mo><mi mathvariant="normal">.</mi></mrow><annotation encoding="application/x-tex">spec ~ ~ collect :: \lambda_{stream} \rightarrow [a].</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span class="mord mathnormal">s</span><span class="mord mathnormal">p</span><span class="mord mathnormal">ec</span><span class="mspace nobreak">&nbsp;</span><span class="mspace nobreak">&nbsp;</span><span class="mord mathnormal">co</span><span class="mord mathnormal" style="margin-right: 0.01968em;">ll</span><span class="mord mathnormal">ec</span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">::</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.84444em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord mathnormal">λ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.280556em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">s</span><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">re</span><span class="mord mathnormal mtight">am</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">[</span><span class="mord mathnormal">a</span><span class="mclose">]</span><span class="mord">.</span></span></span></span></span></p>
<p><span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>p</mi><mi>e</mi><mi>c</mi><mtext>&nbsp;&nbsp;</mtext><mi>c</mi><mi>o</mi><mi>l</mi><mi>l</mi><mi>e</mi><mi>c</mi><mi>t</mi><mo>:</mo><mo>:</mo><msub><mi>λ</mi><mrow><mi>s</mi><mi>t</mi><mi>r</mi><mi>e</mi><mi>a</mi><mi>m</mi></mrow></msub><mtext>&nbsp;&nbsp;</mtext><mo stretchy="false">[</mo><mi>a</mi><mo stretchy="false">]</mo><mo>→</mo><mo stretchy="false">[</mo><mi>a</mi><mo stretchy="false">]</mo><mi mathvariant="normal">.</mi></mrow><annotation encoding="application/x-tex">spec ~ ~ collect :: \lambda_{stream} ~ ~ [a] \rightarrow [a].</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span class="mord mathnormal">s</span><span class="mord mathnormal">p</span><span class="mord mathnormal">ec</span><span class="mspace nobreak">&nbsp;</span><span class="mspace nobreak">&nbsp;</span><span class="mord mathnormal">co</span><span class="mord mathnormal" style="margin-right: 0.01968em;">ll</span><span class="mord mathnormal">ec</span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">::</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord"><span class="mord mathnormal">λ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.280556em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">s</span><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">re</span><span class="mord mathnormal mtight">am</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace nobreak">&nbsp;</span><span class="mspace nobreak">&nbsp;</span><span class="mopen">[</span><span class="mord mathnormal">a</span><span class="mclose">]</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">[</span><span class="mord mathnormal">a</span><span class="mclose">]</span><span class="mord">.</span></span></span></span></span></p>
</blockquote>
<p>The second specification is intended to help build the list result recursively by calling the <code>next</code> function until the iterator is completed.  The definition for the first specification for <code>collect/1</code>is given below.  Notice that the function will call <code>iter</code> to convert the <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>λ</mi><mrow><mi>s</mi><mi>t</mi><mi>r</mi><mi>e</mi><mi>a</mi><mi>m</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\lambda_{stream}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.84444em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord mathnormal">λ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.280556em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">s</span><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">re</span><span class="mord mathnormal mtight">am</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span> into a <code>fixed_iterator</code> prior to doing the recursion to generate the list of values.</p>
<blockquote>
<p><span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mi>e</mi><mi>f</mi><mtext>&nbsp;&nbsp;</mtext><mi>c</mi><mi>o</mi><mi>l</mi><mi>l</mi><mi>e</mi><mi>c</mi><mi>t</mi><mo>:</mo><mo>:</mo><mi>S</mi><mi>t</mi><mi>r</mi><mi>e</mi><mi>a</mi><mi>m</mi><mo>→</mo><mo stretchy="false">(</mo><mi>c</mi><mi>o</mi><mi>l</mi><mi>l</mi><mi>e</mi><mi>c</mi><mi>t</mi><mo stretchy="false">(</mo><mi>i</mi><mi>t</mi><mi>e</mi><mi>r</mi><mtext>&nbsp;&nbsp;</mtext><mi>S</mi><mi>t</mi><mi>r</mi><mi>e</mi><mi>a</mi><mi>m</mi><mo stretchy="false">)</mo><mtext>&nbsp;&nbsp;</mtext><mo stretchy="false">[</mo><mo stretchy="false">]</mo><mo stretchy="false">)</mo><mi mathvariant="normal">.</mi></mrow><annotation encoding="application/x-tex">de\mathit{f} ~ ~ collect :: Stream \rightarrow (collect (iter ~ ~Stream) ~ ~ []).</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathit">f</span><span class="mspace nobreak">&nbsp;</span><span class="mspace nobreak">&nbsp;</span><span class="mord mathnormal">co</span><span class="mord mathnormal" style="margin-right: 0.01968em;">ll</span><span class="mord mathnormal">ec</span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">::</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord mathnormal">St</span><span class="mord mathnormal">re</span><span class="mord mathnormal">am</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">co</span><span class="mord mathnormal" style="margin-right: 0.01968em;">ll</span><span class="mord mathnormal">ec</span><span class="mord mathnormal">t</span><span class="mopen">(</span><span class="mord mathnormal">i</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right: 0.02778em;">er</span><span class="mspace nobreak">&nbsp;</span><span class="mspace nobreak">&nbsp;</span><span class="mord mathnormal">St</span><span class="mord mathnormal">re</span><span class="mord mathnormal">am</span><span class="mclose">)</span><span class="mspace nobreak">&nbsp;</span><span class="mspace nobreak">&nbsp;</span><span class="mopen">[</span><span class="mclose">])</span><span class="mord">.</span></span></span></span></span></p>
</blockquote>
<p>The erlang code for <code>collect/1</code> is given below:</p>
<pre class=" language-erlang"><code class="prism  language-erlang"><span class="token function">collect</span><span class="token punctuation">(</span><span class="token variable">Stream</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token function">collect</span><span class="token punctuation">(</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token variable">Stream</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
</code></pre>
<p>The implementation of the <code>collect/2</code> function is left for an exercise below.</p>
<h2 id="problem-set-2">Problem Set 2</h2>
<ol>
<li>Implement the <code>collect/2</code> function and test it with the code provided.  When writing the function, you should reuse the <code>next</code> function iterate the stream, reuse the <code>value</code> function to get the  value to put in the <code>Result</code> list, and reuse the <code>lambda</code> function to compare with <code>done</code>.  Test code using the <code>collect</code> function with <code>range</code> and <code>words</code> is provided.</li>
</ol>
<h2 id="part-3---erlang-processes--streams">Part 3 - Erlang Processes &amp; Streams</h2>
<p>Another common problem solved with streams is a unique ID generator.  We could write the same code above to obtain a function that will return the next available number  (i.e. prev number + 1).  However, if we had multiple software components that needed to use the same unique ID generator, then we need a slightly different approach.</p>
<p>Erlang supports a scalable process system that allows for safe concurrent operations.  This process system can be used locally with our software or it can be used along with networking code to support communication between different machines.</p>
<p>The diagram below shows how a client/server process architecture can be setup in Erlang.  We will assume in our discussion that both the client and the server are running locally on our same machine.</p>
<p><img src="https://macbeth-byui.github.io/cse382-course/images/client_server_erlang.drawio.png" alt="Client Server Erlang"></p>
<p>In the diagram above, we have a process that is started (or spawned) by <code>start_server</code> and handles messages received by <code>handle_server</code>.  The client uses the server process ID (PID) to send messages to the server and then waits for a response.  All messages sent to the server are formatted as follows:</p>
<blockquote>
<p><span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">{</mo><mi>C</mi><mi>l</mi><mi>i</mi><mi>e</mi><mi>n</mi><mi>t</mi><mi mathvariant="normal">_</mi><mi>P</mi><mi>I</mi><mi>D</mi><mo separator="true">,</mo><mi>C</mi><mi>o</mi><mi>m</mi><mi>m</mi><mi>a</mi><mi>n</mi><mi>d</mi><mo separator="true">,</mo><mo stretchy="false">{</mo><mi>P</mi><mi>a</mi><mi>r</mi><mi>a</mi><mi>m</mi><mi>e</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>s</mi><mo stretchy="false">}</mo><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">\lbrace Client\_PID, Command, \lbrace Parameters \rbrace \rbrace</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1.06em; vertical-align: -0.31em;"></span><span class="mopen">{</span><span class="mord mathnormal" style="margin-right: 0.01968em;">Cl</span><span class="mord mathnormal">i</span><span class="mord mathnormal">e</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span><span class="mord" style="margin-right: 0.02778em;">_</span><span class="mord mathnormal" style="margin-right: 0.13889em;">P</span><span class="mord mathnormal" style="margin-right: 0.07847em;">I</span><span class="mord mathnormal" style="margin-right: 0.02778em;">D</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathnormal" style="margin-right: 0.07153em;">C</span><span class="mord mathnormal">o</span><span class="mord mathnormal">mman</span><span class="mord mathnormal">d</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mopen">{</span><span class="mord mathnormal" style="margin-right: 0.13889em;">P</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right: 0.02778em;">r</span><span class="mord mathnormal">am</span><span class="mord mathnormal">e</span><span class="mord mathnormal">t</span><span class="mord mathnormal">ers</span><span class="mclose">}}</span></span></span></span></span></p>
</blockquote>
<p>Response back to the client are formatted as follows:</p>
<blockquote>
<p><span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">{</mo><mi>R</mi><mi>e</mi><mi>s</mi><mi>p</mi><mi>o</mi><mi>n</mi><mi>s</mi><mi>e</mi><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">\lbrace Response \rbrace</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">{</span><span class="mord mathnormal" style="margin-right: 0.00773em;">R</span><span class="mord mathnormal">es</span><span class="mord mathnormal">p</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mord mathnormal">se</span><span class="mclose">}</span></span></span></span></span></p>
</blockquote>
<p>This simple server has only two commands:</p>
<ul>
<li>echo - Send the text back to the client</li>
<li>add - Add the two numbers and send back the answer to the client.</li>
</ul>
<p>The server can handle only one request at a time.  After the server handles the request, the <code>handle_server</code> function is called again to handle the next request.  This ability to handle only one thing at a time will help us create the unique ID server later on.  Let’s first look at the Erlang code needed:</p>
<pre class=" language-erlang"><code class="prism  language-erlang"><span class="token function">handle_server</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span>
	<span class="token keyword">receive</span>
		<span class="token punctuation">{</span><span class="token variable">Client_PID</span><span class="token punctuation">,</span> <span class="token atom">echo</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token variable">Text</span><span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token variable">Client_PID</span> <span class="token operator">!</span> <span class="token punctuation">{</span><span class="token variable">Text</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
		<span class="token punctuation">{</span><span class="token variable">Client_PID</span><span class="token punctuation">,</span> <span class="token atom">add</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token variable">X</span><span class="token punctuation">,</span> <span class="token variable">Y</span><span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token variable">Client_PID</span> <span class="token operator">!</span> <span class="token punctuation">{</span><span class="token variable">X</span><span class="token operator">+</span><span class="token variable">Y</span><span class="token punctuation">}</span>
	<span class="token keyword">end</span><span class="token punctuation">,</span>
	<span class="token function">handle_server</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>

<span class="token function">start_server</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span>
	<span class="token function">spawn</span><span class="token punctuation">(</span><span class="token atom">prove07</span><span class="token punctuation">,</span> <span class="token atom">handle_server</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
 
<span class="token function">send_to_server</span><span class="token punctuation">(</span><span class="token variable">Server_PID</span><span class="token punctuation">,</span> <span class="token variable">Command</span><span class="token punctuation">,</span> <span class="token variable">Params</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span>
	<span class="token variable">Server_PID</span> <span class="token operator">!</span> <span class="token punctuation">{</span><span class="token function">self</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token variable">Command</span><span class="token punctuation">,</span> <span class="token variable">Params</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token keyword">receive</span>
		<span class="token punctuation">{</span><span class="token variable">Response</span><span class="token punctuation">}</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token variable">Response</span>
	<span class="token keyword">end</span><span class="token punctuation">.</span>
</code></pre>
<p>The <code>start_server</code> function will spawn a new process.  When spawning a new process, the handler function is specified along with its module name and a list of any parameters.  In this simple example, there are no parameters.  Note that you have to export the <code>handle_server</code> function for the <code>spawn</code> function to work properly.</p>
<p>The <code>handle_server</code> function uses the <code>receive</code> command to receive a message from a client.  When one is received and matches one of the patterns in the <code>receive</code> command block, then a response is sent back.  In Erlang, a message is sent using the syntax: <code>PID ! Message</code>.  We use the Client PID that we received to send the response back.  The call to <code>handle_server</code> recursively at the end will allow the server to response to the next client.</p>
<p>The <code>send_to_server</code> function is a utility function to help us send a message to server and receive the response.  When sending messages to the server, the Erlang function <code>self()</code> is called to obtain the client PID to send to the server.   A test example is shown below:</p>
<pre class=" language-shell"><code class="prism  language-shell">2&gt; Server_PID = prove07:start_server().
&lt;0.85.0&gt;
3&gt; prove07:send_to_server(Server_PID, echo, {"Hello"}).
"Hello"
4&gt; prove07:send_to_server(Server_PID, add, {13, 8}).    
21
5&gt;
</code></pre>
<p>If we wanted to create a unique ID server following this same format, we can modify our handler function to take a parameter that keeps track of the current ID.  Remember that each call to the handler function is guaranteed to handle only one client at a time.  Similar to the concept of the stream functions being created with the next value in the stream, our handler will create the next value to be used.</p>
<p>Here is the code for our new <code>start_id_server</code> and <code>handle_id_server</code>.  Notice that the <code>handle_id_server</code> now has an input parameter and it is initialized in the spawn function within <code>start_id_server</code>.   For the <code>export</code>, notice that we specify the arity: <code>handle_id_server/1</code>.</p>
<pre class=" language-erlang"><code class="prism  language-erlang"><span class="token operator">-</span><span class="token function">export</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token atom">handle_id_server</span><span class="token operator">/</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>

<span class="token function">handle_id_server</span><span class="token punctuation">(</span><span class="token variable">Curr_ID</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span>
	<span class="token keyword">receive</span>
		<span class="token punctuation">{</span><span class="token variable">Client_PID</span><span class="token punctuation">,</span> <span class="token atom">id</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token variable">Client_PID</span> <span class="token operator">!</span> <span class="token punctuation">{</span><span class="token variable">Curr_ID</span><span class="token punctuation">}</span>
	<span class="token keyword">end</span><span class="token punctuation">,</span>
	<span class="token function">handle_id_server</span><span class="token punctuation">(</span><span class="token variable">Curr_ID</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>

<span class="token function">start_id_server</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span>
	<span class="token function">spawn</span><span class="token punctuation">(</span><span class="token atom">prove07</span><span class="token punctuation">,</span> <span class="token atom">handle_id_server</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
</code></pre>
<p>When the <code>handle_id_server</code> is called recursively to handle the request from the next client, the <code>Unique_ID</code> is incremented by 1.</p>
<p>Reusing the same <code>send_to_server</code> function, we can generate new unique ID’s as follows starting with 0.</p>
<pre class=" language-shell"><code class="prism  language-shell">5&gt; ID_Server_PID = prove07:start_id_server(). 
&lt;0.89.0&gt;
6&gt; prove07:send_to_server(ID_Server_PID, id, {}).       
0
7&gt; prove07:send_to_server(ID_Server_PID, id, {}).
1
8&gt; prove07:send_to_server(ID_Server_PID, id, {}).
2
9&gt; prove07:send_to_server(ID_Server_PID, id, {}).
3
10&gt; prove07:send_to_server(ID_Server_PID, id, {}).
4
11&gt; prove07:send_to_server(ID_Server_PID, id, {}).
5
12&gt; 
</code></pre>
<h2 id="problem-set-3">Problem Set 3</h2>
<ol>
<li>
<p>Modify the <code>handle_server</code> function to support an <code>avg</code> command that will average a variable collection of numbers.  For example, if the parameters field is <code>{10,20,30,40}</code> then 25 will be returned back to the client.  You can use the Erlang <code>lists:sum</code> and <code>length</code> functions.</p>
</li>
<li>
<p>Create a server based on the Unique ID server but with functions called <code>handle_running_avg_server</code> (remember that this one needs to be exported) and <code>start_running_avg_server</code> that maintains a running average of numbers submitted.  There should be three commands:</p>
<ul>
<li>add - Adds a number to the running average and returns the current average</li>
<li>remove - Removes a number from the running average and returns the current average</li>
<li>display - Returns the current average</li>
</ul>
<p>When implementing the running average server, you should save the current sum and current number of numbers in your server.  You should not store the list of numbers.  Test code is provided for you.</p>
</li>
</ol>

    </div>
  </div>
</body>

</html>

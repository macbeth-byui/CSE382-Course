<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>lesson10.md</title>
  <link rel="stylesheet" href="https://stackedit.io/style.css" />
</head>

<body class="stackedit">
  <div class="stackedit__left">
    <div class="stackedit__toc">
      
<ul>
<li><a href="#cse-382-lesson-10---random-access-lists">CSE 382 Lesson 10 - Random Access Lists</a>
<ul>
<li><a href="#part-1---binary-numbers-and-the-ral">Part 1 - Binary Numbers and the RAL</a></li>
<li><a href="#problem-set-1">Problem Set 1</a></li>
<li><a href="#part-2---lookup-and-update">Part 2 - Lookup and Update</a></li>
<li><a href="#problem-set-2">Problem Set 2</a></li>
<li><a href="#part-3---performance">Part 3 - Performance</a></li>
<li><a href="#problem-set-3">Problem Set 3</a></li>
</ul>
</li>
</ul>

    </div>
  </div>
  <div class="stackedit__right">
    <div class="stackedit__html">
      <h1 id="cse-382-lesson-10---random-access-lists">CSE 382 Lesson 10 - Random Access Lists</h1>
<p>The lists that we have used in this course have been linked lists.  If we want to find something in the list, we have to search resulting in O(n) performance.  We could use a binary search tree or a min heap to help us find things better but then we lose the order in which items were added.  The name of dynamic arrays for which you can maintain order and have good lookup by index is done differently in functional languages when compared to the python list, the java ArrayList, or the C++ vector.  A common solution is the Random Access List (RAL).</p>
<p>You can find the template for the problem sets in this lesson here: <a href="https://macbeth-byui.github.io/cse382-course/proves/prove10.erl">prove10.erl</a></p>
<h2 id="part-1---binary-numbers-and-the-ral">Part 1 - Binary Numbers and the RAL</h2>
<p>In Erlang, there is not a way to quickly access a specific index in a list with O(1).  In Part 3, you will explore the performance of the <code>nth</code> function that Erlang provides to do this.  The difficulty is that we have to traverse through the entire list from beginning to the target index.  To improve on this, we would like to find an O(log n) solution that maintains the order of the values.  O(log n) makes us think about binary search trees.  However, we need to store information in the trees that keeps the order the same.  Binary Search Trees  sacrifice order for performance.</p>
<p>To find a solution, we will consider a problem that at first does not seem related.  Consider binary numbers (purposefully with leading zeros) going from 1 to 7:  001, 010, 011, 100, 101, 110, and 111.  When we want to add 1 to our number, we will go from right to left and do one of the following:</p>
<ul>
<li>If we encounter a 0, we will replace it with a 1 and make no more changes.</li>
<li>If we encounter a 1, we will replace it with a 0 and consider these two steps again for the next number in the sequence.  In this case we are mathematically carrying the 1 to the next item in the sequence.</li>
</ul>
<p>If we try to do this in Erlang, we will be frustrated by the fact that we are going from right to left.  Since it is more natural to go left (index 0) to right, we will flip our binary numbers around.  When we read right to left, we call this little endian notation whereas when we read left to right, we call this big endian notation.  To work better in Erlang, we will use the big endian notation</p>

<table>
<thead>
<tr>
<th>Base 10 Value</th>
<th>Little Endian Notation (Right to Left)</th>
<th>Big Endian Notation (Left to Right)</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>001</td>
<td>100</td>
</tr>
<tr>
<td>2</td>
<td>010</td>
<td>010</td>
</tr>
<tr>
<td>3</td>
<td>011</td>
<td>110</td>
</tr>
<tr>
<td>4</td>
<td>100</td>
<td>001</td>
</tr>
<tr>
<td>5</td>
<td>101</td>
<td>101</td>
</tr>
<tr>
<td>6</td>
<td>110</td>
<td>011</td>
</tr>
<tr>
<td>7</td>
<td>111</td>
<td>111</td>
</tr>
</tbody>
</table><p>Here is the specification and definition for incrementing a binary sequence (going left to right in big endian format) where the sequence starts at 1 and the sequence is stored in a list.  Note that the definition follows the two rules for incrementing a binary sequence that we identified earlier.  An empty list would represent the value of 0.</p>
<blockquote>
<p><span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>p</mi><mi>e</mi><mi>c</mi><mtext>&nbsp;&nbsp;</mtext><mi>i</mi><mi>n</mi><mi>c</mi><mo>:</mo><mo>:</mo><mo stretchy="false">[</mo><mi>i</mi><mi>n</mi><mi>t</mi><mi>e</mi><mi>g</mi><mi>e</mi><mi>r</mi><mo stretchy="false">]</mo><mo>→</mo><mo stretchy="false">[</mo><mi>i</mi><mi>n</mi><mi>t</mi><mi>e</mi><mi>g</mi><mi>e</mi><mi>r</mi><mo stretchy="false">]</mo><mi mathvariant="normal">.</mi></mrow><annotation encoding="application/x-tex">spec ~ ~ inc :: [integer] \rightarrow [integer].</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.85396em; vertical-align: -0.19444em;"></span><span class="mord mathnormal">s</span><span class="mord mathnormal">p</span><span class="mord mathnormal">ec</span><span class="mspace nobreak">&nbsp;</span><span class="mspace nobreak">&nbsp;</span><span class="mord mathnormal">in</span><span class="mord mathnormal">c</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">::</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">[</span><span class="mord mathnormal">in</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right: 0.03588em;">g</span><span class="mord mathnormal" style="margin-right: 0.02778em;">er</span><span class="mclose">]</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">[</span><span class="mord mathnormal">in</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right: 0.03588em;">g</span><span class="mord mathnormal" style="margin-right: 0.02778em;">er</span><span class="mclose">]</span><span class="mord">.</span></span></span></span></span></p>
<p><span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mi>e</mi><mi>f</mi><mtext>&nbsp;&nbsp;</mtext><mi>i</mi><mi>n</mi><mi>c</mi><mo>:</mo><mo>:</mo><mo stretchy="false">[</mo><mn>0</mn><mi mathvariant="normal">∣</mi><mi>R</mi><mi>e</mi><mi>s</mi><mi>t</mi><mo stretchy="false">]</mo><mo>→</mo><mo stretchy="false">[</mo><mn>1</mn><mi mathvariant="normal">∣</mi><mi>R</mi><mi>e</mi><mi>s</mi><mi>t</mi><mo stretchy="false">]</mo><mo separator="true">;</mo></mrow><annotation encoding="application/x-tex">de\mathit{f} ~ ~ inc :: [0|Rest] \rightarrow [1|Rest];</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathit">f</span><span class="mspace nobreak">&nbsp;</span><span class="mspace nobreak">&nbsp;</span><span class="mord mathnormal">in</span><span class="mord mathnormal">c</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">::</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">[</span><span class="mord">0∣</span><span class="mord mathnormal" style="margin-right: 0.00773em;">R</span><span class="mord mathnormal">es</span><span class="mord mathnormal">t</span><span class="mclose">]</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">[</span><span class="mord">1∣</span><span class="mord mathnormal" style="margin-right: 0.00773em;">R</span><span class="mord mathnormal">es</span><span class="mord mathnormal">t</span><span class="mclose">]</span><span class="mpunct">;</span></span></span></span></span><br>
<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mi>e</mi><mi>f</mi><mtext>&nbsp;&nbsp;</mtext><mi>i</mi><mi>n</mi><mi>c</mi><mo>:</mo><mo>:</mo><mo stretchy="false">[</mo><mn>1</mn><mi mathvariant="normal">∣</mi><mi>R</mi><mi>e</mi><mi>s</mi><mi>t</mi><mo stretchy="false">]</mo><mo>→</mo><mo stretchy="false">[</mo><mn>0</mn><mi mathvariant="normal">∣</mi><mi>i</mi><mi>n</mi><mi>c</mi><mo stretchy="false">(</mo><mi>R</mi><mi>e</mi><mi>s</mi><mi>t</mi><mo stretchy="false">)</mo><mo stretchy="false">]</mo><mo separator="true">;</mo></mrow><annotation encoding="application/x-tex">de\mathit{f} ~ ~ inc :: [1|Rest] \rightarrow [0|inc(Rest)];</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathit">f</span><span class="mspace nobreak">&nbsp;</span><span class="mspace nobreak">&nbsp;</span><span class="mord mathnormal">in</span><span class="mord mathnormal">c</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">::</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">[</span><span class="mord">1∣</span><span class="mord mathnormal" style="margin-right: 0.00773em;">R</span><span class="mord mathnormal">es</span><span class="mord mathnormal">t</span><span class="mclose">]</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">[</span><span class="mord">0∣</span><span class="mord mathnormal">in</span><span class="mord mathnormal">c</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right: 0.00773em;">R</span><span class="mord mathnormal">es</span><span class="mord mathnormal">t</span><span class="mclose">)]</span><span class="mpunct">;</span></span></span></span></span></p>
</blockquote>
<p>The erlang code is shown below:</p>
<pre class=" language-erlang"><code class="prism  language-erlang"><span class="token function">inc</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token function">inc</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">|</span><span class="token variable">Rest</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">|</span><span class="token variable">Rest</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token function">inc</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">|</span><span class="token variable">Rest</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">|</span><span class="token function">inc</span><span class="token punctuation">(</span><span class="token variable">Rest</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">.</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span>
	<span class="token atom">lists</span><span class="token punctuation">:</span><span class="token function">foldl</span><span class="token punctuation">(</span>
		<span class="token keyword">fun</span><span class="token punctuation">(</span><span class="token variable">_Value</span><span class="token punctuation">,</span><span class="token variable">Acc</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> 
			<span class="token variable">X</span><span class="token operator">=</span><span class="token function">inc</span><span class="token punctuation">(</span><span class="token variable">Acc</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
			<span class="token atom">io</span><span class="token punctuation">:</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"~p~n"</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token variable">X</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
			<span class="token variable">X</span> 
		<span class="token keyword">end</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token atom">lists</span><span class="token punctuation">:</span><span class="token function">seq</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token atom">pass</span><span class="token punctuation">.</span>
</code></pre>
<p>The result of running the test code up to 15 (1111) is shown below:</p>
<pre class=" language-shell"><code class="prism  language-shell">[1]
[0,1]
[1,1]
[0,0,1]
[1,0,1]
[0,1,1]
[1,1,1]
[0,0,0,1]
[1,0,0,1]
[0,1,0,1]
[1,1,0,1]
[0,0,1,1]
[1,0,1,1]
[0,1,1,1]
[1,1,1,1]
</code></pre>
<p>Now that we can build these binary sequences, lets observe what each “1” represents.  Notice that when you write binary numbers, each “1” represents <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><mi>n</mi></msup></mrow><annotation encoding="application/x-tex">2^n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.664392em; vertical-align: 0em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.664392em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span></span></span></span></span></span></span></span> possible values.  In other words, we could say that each “1” is storing those values for us.  In the following binary sequence (written left to right as we did before): 1011, the 1’s represent: <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><mn>0</mn></msup></mrow><annotation encoding="application/x-tex">2^0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.814108em; vertical-align: 0em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.814108em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span></span></span></span></span></span></span></span></span>, <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">2^2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.814108em; vertical-align: 0em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.814108em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></span>, and <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><mn>3</mn></msup></mrow><annotation encoding="application/x-tex">2^3</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.814108em; vertical-align: 0em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.814108em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span></span></span></span></span></span></span></span></span> for a total of 13.  In other words we could say that 1011 represents 13 different things.</p>
<p>To see those 13 different things, we will represent each 1 by a tree.  These trees will be special in that each tree will have <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><mi>n</mi></msup></mrow><annotation encoding="application/x-tex">2^n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.664392em; vertical-align: 0em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.664392em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span></span></span></span></span></span></span></span> leaves where <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.43056em; vertical-align: 0em;"></span><span class="mord mathnormal">n</span></span></span></span></span> represents the index in the binary sequence (starting at 0).  Trees with <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><mi>n</mi></msup></mrow><annotation encoding="application/x-tex">2^n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.664392em; vertical-align: 0em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.664392em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span></span></span></span></span></span></span></span> leaves are not hard to build.  A complete and balanced tree of height 2 will have <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">2^2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.814108em; vertical-align: 0em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.814108em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></span> leaves, a tree with height 3 will have <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><mn>3</mn></msup></mrow><annotation encoding="application/x-tex">2^3</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.814108em; vertical-align: 0em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.814108em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span></span></span></span></span></span></span></span></span> leaves, and so on.  Here is the representation of 1011 (or 13) using these trees:</p>
<p><img src="https://macbeth-byui.github.io/cse382-course/images/ral13.drawio.png" alt="ral 13"></p>
<p>Notice that the 0’s are represented with <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mi>i</mi><mi>l</mi></mrow><annotation encoding="application/x-tex">nil</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.69444em; vertical-align: 0em;"></span><span class="mord mathnormal">ni</span><span class="mord mathnormal" style="margin-right: 0.01968em;">l</span></span></span></span></span> instead of a tree.  We call this list of trees a Random Access List (RAL).  When you look at this list of trees, you will notice there are a grand total of 13 leaves.  Each of these leaves represent the actual 13 pieces of data in the RAL.  All the other nodes in the tree including the <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mi>i</mi><mi>l</mi></mrow><annotation encoding="application/x-tex">nil</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.69444em; vertical-align: 0em;"></span><span class="mord mathnormal">ni</span><span class="mord mathnormal" style="margin-right: 0.01968em;">l</span></span></span></span></span> values in the list represent the organization of the RAL to enable the O(log n) behavior.  If you wanted to go to one of these leaves, you could traverse the sequence from left to right (which would be O(log n)) and then traverse down to one of the leaves (which would also be O(log n)).  We will explore how this works in the next section.</p>
<p>To add new items to a RAL, we will use a similar algorithm for adding one to our binary sequence:</p>
<ul>
<li>If we encounter a <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mi>i</mi><mi>l</mi></mrow><annotation encoding="application/x-tex">nil</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.69444em; vertical-align: 0em;"></span><span class="mord mathnormal">ni</span><span class="mord mathnormal" style="margin-right: 0.01968em;">l</span></span></span></span></span> (think a 0 in the binary sequence), we will replace it with a tree (think a 1) containing <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><mi>n</mi></msup></mrow><annotation encoding="application/x-tex">2^n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.664392em; vertical-align: 0em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.664392em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span></span></span></span></span></span></span></span> (where is <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.43056em; vertical-align: 0em;"></span><span class="mord mathnormal">n</span></span></span></span></span> is our current index) and make no more changes.  The tree that we add will either be a tree of height 1 (if the RAL was previously empty) or it will be a tree that was carried over from the recursive call in the next step below.</li>
<li>If we encounter a tree (not <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mi>i</mi><mi>l</mi></mrow><annotation encoding="application/x-tex">nil</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.69444em; vertical-align: 0em;"></span><span class="mord mathnormal">ni</span><span class="mord mathnormal" style="margin-right: 0.01968em;">l</span></span></span></span></span>, think a 1 in the binary sequence), we will replace it with a <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mi>i</mi><mi>l</mi></mrow><annotation encoding="application/x-tex">nil</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.69444em; vertical-align: 0em;"></span><span class="mord mathnormal">ni</span><span class="mord mathnormal" style="margin-right: 0.01968em;">l</span></span></span></span></span> (think 0) and carry the tree to the next sequence and recursively consider these two steps again.   If a tree was carried over, then we have to carry both the tree(s) from the previous sequence position(s) along with this position.</li>
</ul>
<p>Let’s visually look at how this works first as we store letters in a RAL starting with an empty RAL.  Notice that when we add a new letter to our RAL, it will prepend it to the front just like adding a new digit to a binary sequence.  In each diagram, a non-leaf node is left empty and the leaf nodes contain the actual data. Remember that each tree must be balanced and complete with <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><mi>n</mi></msup></mrow><annotation encoding="application/x-tex">2^n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.664392em; vertical-align: 0em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.664392em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span></span></span></span></span></span></span></span> leaves each.</p>
<p>Add A to an empty RAL:</p>
<p><img src="https://macbeth-byui.github.io/cse382-course/images/ral1.drawio.png" alt="ral 1"></p>
<p>Add B to the RAL (will require a replacement of the first tree with a <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mi>i</mi><mi>l</mi></mrow><annotation encoding="application/x-tex">nil</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.69444em; vertical-align: 0em;"></span><span class="mord mathnormal">ni</span><span class="mord mathnormal" style="margin-right: 0.01968em;">l</span></span></span></span></span> and merge the new tree with B and the former tree with A):</p>
<p><img src="https://macbeth-byui.github.io/cse382-course/images/ral2.drawio.png" alt="ral 2"></p>
<p>Add C to the RAL (there is a space to put the new tree with C):</p>
<p><img src="https://macbeth-byui.github.io/cse382-course/images/ral3.drawio.png" alt="ral 3"></p>
<p>Add D to the RAL (have to merge the C and D and then merge it with the B/A tree and then put it in the next available spot to the right):</p>
<p><img src="https://macbeth-byui.github.io/cse382-course/images/ral4.drawio.png" alt="ral 4"></p>
<p>Add E (space exists for that in index 0):</p>
<p><img src="https://macbeth-byui.github.io/cse382-course/images/ral5.drawio.png" alt="ral 5"></p>
<p>Add F (merge the new tree with F and the the tree with E … notice that the binary number shown above the boxes is increasing like our first binary example):</p>
<p><img src="https://macbeth-byui.github.io/cse382-course/images/ral6.drawio.png" alt="ral 6"></p>
<p>Add G (which has an available space):</p>
<p><img src="https://macbeth-byui.github.io/cse382-course/images/ral7.drawio.png" alt="ral 7"></p>
<p>Finally add H (which requires us to merge our new tree with H along with the other 3 trees to create the new tree in index 3).</p>
<p><img src="https://macbeth-byui.github.io/cse382-course/images/ral8.drawio.png" alt="ral 8"></p>
<p>To create the RAL in software, we will need a structure to represent each of the trees in the list.  The root node of each of the trees will be represented by a <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><mi>a</mi><mi>l</mi><mi mathvariant="normal">_</mi><mi>t</mi><mi>r</mi><mi>e</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">ral\_tree</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1.00444em; vertical-align: -0.31em;"></span><span class="mord mathnormal" style="margin-right: 0.02778em;">r</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right: 0.01968em;">l</span><span class="mord" style="margin-right: 0.02778em;">_</span><span class="mord mathnormal">t</span><span class="mord mathnormal">ree</span></span></span></span></span> node.  Our structure distinguishes between non-leaf nodes (no values) and leaf nodes (values).  The non-leaf nodes called <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mi>o</mi><mi>d</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">node</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.69444em; vertical-align: 0em;"></span><span class="mord mathnormal">n</span><span class="mord mathnormal">o</span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span></span></span></span></span> will include a reference to the left and right sub-trees as well as a <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi><mi>o</mi><mi>u</mi><mi>n</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">Count</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord mathnormal" style="margin-right: 0.07153em;">C</span><span class="mord mathnormal">o</span><span class="mord mathnormal">u</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span></span></span></span></span>.  The <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi><mi>o</mi><mi>u</mi><mi>n</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">Count</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord mathnormal" style="margin-right: 0.07153em;">C</span><span class="mord mathnormal">o</span><span class="mord mathnormal">u</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span></span></span></span></span> will represent the number of leaves under this node.  The <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi><mi>o</mi><mi>u</mi><mi>n</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">Count</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord mathnormal" style="margin-right: 0.07153em;">C</span><span class="mord mathnormal">o</span><span class="mord mathnormal">u</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span></span></span></span></span> of a leaf node will always be 1.  We store the <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi><mi>o</mi><mi>u</mi><mi>n</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">Count</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord mathnormal" style="margin-right: 0.07153em;">C</span><span class="mord mathnormal">o</span><span class="mord mathnormal">u</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span></span></span></span></span> in each non-leaf node to make it easier to merge a <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><mi>a</mi><msub><mi>l</mi><mi>t</mi></msub><mi>r</mi><mi>e</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">ral_tree</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.84444em; vertical-align: -0.15em;"></span><span class="mord mathnormal" style="margin-right: 0.02778em;">r</span><span class="mord mathnormal">a</span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.01968em;">l</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.280556em;"><span class="" style="top: -2.55em; margin-left: -0.01968em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord mathnormal">ree</span></span></span></span></span> with another <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><mi>a</mi><msub><mi>l</mi><mi>t</mi></msub><mi>r</mi><mi>e</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">ral_tree</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.84444em; vertical-align: -0.15em;"></span><span class="mord mathnormal" style="margin-right: 0.02778em;">r</span><span class="mord mathnormal">a</span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.01968em;">l</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.280556em;"><span class="" style="top: -2.55em; margin-left: -0.01968em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord mathnormal">ree</span></span></span></span></span>.  We will also use this <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi><mi>o</mi><mi>u</mi><mi>n</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">Count</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord mathnormal" style="margin-right: 0.07153em;">C</span><span class="mord mathnormal">o</span><span class="mord mathnormal">u</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span></span></span></span></span> when trying to access values in our RAL by index later on.</p>
<blockquote>
<p><span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>t</mi><mi>r</mi><mi>u</mi><mi>c</mi><mi>t</mi><mtext>&nbsp;&nbsp;</mtext><mi>r</mi><mi>a</mi><mi>l</mi><mi mathvariant="normal">_</mi><mi>t</mi><mi>r</mi><mi>e</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">struct ~ ~ ral\_tree</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1.00444em; vertical-align: -0.31em;"></span><span class="mord mathnormal">s</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right: 0.02778em;">r</span><span class="mord mathnormal">u</span><span class="mord mathnormal">c</span><span class="mord mathnormal">t</span><span class="mspace nobreak">&nbsp;</span><span class="mspace nobreak">&nbsp;</span><span class="mord mathnormal" style="margin-right: 0.02778em;">r</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right: 0.01968em;">l</span><span class="mord" style="margin-right: 0.02778em;">_</span><span class="mord mathnormal">t</span><span class="mord mathnormal">ree</span></span></span></span></span><br>
<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mspace width="2em"></mspace><mo stretchy="false">{</mo><mi>a</mi><mi>t</mi><mi>o</mi><mi>m</mi><mo stretchy="false">(</mo><mi>n</mi><mi>o</mi><mi>d</mi><mi>e</mi><mo stretchy="false">)</mo><mo separator="true">,</mo><mi>i</mi><mi>n</mi><mi>t</mi><mi>e</mi><mi>g</mi><mi>e</mi><mi>r</mi><mo>:</mo><mi>C</mi><mi>o</mi><mi>u</mi><mi>n</mi><mi>t</mi><mo separator="true">,</mo><mi>r</mi><mi>a</mi><mi>l</mi><mi mathvariant="normal">_</mi><mi>t</mi><mi>r</mi><mi>e</mi><mi>e</mi><mo>:</mo><mi>L</mi><mi>e</mi><mi>f</mi><mi>t</mi><mo separator="true">,</mo><mi>r</mi><mi>a</mi><mi>l</mi><mi mathvariant="normal">_</mi><mi>t</mi><mi>r</mi><mi>e</mi><mi>e</mi><mo>:</mo><mi>R</mi><mi>i</mi><mi>g</mi><mi>h</mi><mi>t</mi><mo stretchy="false">}</mo><mtext>&nbsp;&nbsp;</mtext><mi>o</mi><mi>r</mi></mrow><annotation encoding="application/x-tex">\kern{2em}\lbrace atom(node), integer:Count, ral\_tree:Le\mathit{f}t, ral\_tree:Right \rbrace ~ ~ or</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mspace" style="margin-right: 2em;"></span><span class="mopen">{</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal">o</span><span class="mord mathnormal">m</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mord mathnormal">o</span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathnormal">in</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right: 0.03588em;">g</span><span class="mord mathnormal" style="margin-right: 0.02778em;">er</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">:</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1.00444em; vertical-align: -0.31em;"></span><span class="mord mathnormal" style="margin-right: 0.07153em;">C</span><span class="mord mathnormal">o</span><span class="mord mathnormal">u</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathnormal" style="margin-right: 0.02778em;">r</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right: 0.01968em;">l</span><span class="mord" style="margin-right: 0.02778em;">_</span><span class="mord mathnormal">t</span><span class="mord mathnormal">ree</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">:</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1.00444em; vertical-align: -0.31em;"></span><span class="mord mathnormal">L</span><span class="mord mathnormal">e</span><span class="mord mathit">f</span><span class="mord mathnormal">t</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathnormal" style="margin-right: 0.02778em;">r</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right: 0.01968em;">l</span><span class="mord" style="margin-right: 0.02778em;">_</span><span class="mord mathnormal">t</span><span class="mord mathnormal">ree</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">:</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal" style="margin-right: 0.00773em;">R</span><span class="mord mathnormal">i</span><span class="mord mathnormal" style="margin-right: 0.03588em;">g</span><span class="mord mathnormal">h</span><span class="mord mathnormal">t</span><span class="mclose">}</span><span class="mspace nobreak">&nbsp;</span><span class="mspace nobreak">&nbsp;</span><span class="mord mathnormal" style="margin-right: 0.02778em;">or</span></span></span></span></span><br>
<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mspace width="2em"></mspace><mo stretchy="false">{</mo><mi>a</mi><mi>t</mi><mi>o</mi><mi>m</mi><mo stretchy="false">(</mo><mi>l</mi><mi>e</mi><mi>a</mi><mi>f</mi><mo stretchy="false">)</mo><mo separator="true">,</mo><mi>a</mi><mo>:</mo><mi>V</mi><mi>a</mi><mi>l</mi><mi>u</mi><mi>e</mi><mo stretchy="false">}</mo><mi mathvariant="normal">.</mi></mrow><annotation encoding="application/x-tex">\kern{2em}\lbrace atom(lea\mathit{f}), a:Value \rbrace.</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mspace" style="margin-right: 2em;"></span><span class="mopen">{</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal">o</span><span class="mord mathnormal">m</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right: 0.01968em;">l</span><span class="mord mathnormal">e</span><span class="mord mathnormal">a</span><span class="mord mathit">f</span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathnormal">a</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">:</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal">Va</span><span class="mord mathnormal" style="margin-right: 0.01968em;">l</span><span class="mord mathnormal">u</span><span class="mord mathnormal">e</span><span class="mclose">}</span><span class="mord">.</span></span></span></span></span></p>
</blockquote>
<p>The RAL will be represented by a list of <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><mi>a</mi><mi>l</mi><mi mathvariant="normal">_</mi><mi>t</mi><mi>r</mi><mi>e</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">ral\_tree</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1.00444em; vertical-align: -0.31em;"></span><span class="mord mathnormal" style="margin-right: 0.02778em;">r</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right: 0.01968em;">l</span><span class="mord" style="margin-right: 0.02778em;">_</span><span class="mord mathnormal">t</span><span class="mord mathnormal">ree</span></span></span></span></span> objects.  Our prepend function will use the following specification and definition:</p>
<blockquote>
<p><span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>p</mi><mi>e</mi><mi>c</mi><mtext>&nbsp;&nbsp;</mtext><mi>p</mi><mi>r</mi><mi>e</mi><mi>p</mi><mi>e</mi><mi>n</mi><mi>d</mi><mo>:</mo><mo>:</mo><mi>a</mi><mtext>&nbsp;&nbsp;</mtext><mo stretchy="false">[</mo><mi>r</mi><mi>a</mi><mi>l</mi><mi mathvariant="normal">_</mi><mi>t</mi><mi>r</mi><mi>e</mi><mi>e</mi><mo stretchy="false">]</mo><mo>→</mo><mo stretchy="false">[</mo><mi>r</mi><mi>a</mi><mi>l</mi><mi mathvariant="normal">_</mi><mi>t</mi><mi>r</mi><mi>e</mi><mi>e</mi><mo stretchy="false">]</mo><mi mathvariant="normal">.</mi></mrow><annotation encoding="application/x-tex">spec ~ ~ prepend :: a ~ ~ [ral\_tree] \rightarrow [ral\_tree].</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span class="mord mathnormal">s</span><span class="mord mathnormal">p</span><span class="mord mathnormal">ec</span><span class="mspace nobreak">&nbsp;</span><span class="mspace nobreak">&nbsp;</span><span class="mord mathnormal">p</span><span class="mord mathnormal">re</span><span class="mord mathnormal">p</span><span class="mord mathnormal">e</span><span class="mord mathnormal">n</span><span class="mord mathnormal">d</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">::</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1.06em; vertical-align: -0.31em;"></span><span class="mord mathnormal">a</span><span class="mspace nobreak">&nbsp;</span><span class="mspace nobreak">&nbsp;</span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right: 0.02778em;">r</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right: 0.01968em;">l</span><span class="mord" style="margin-right: 0.02778em;">_</span><span class="mord mathnormal">t</span><span class="mord mathnormal">ree</span><span class="mclose">]</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1.06em; vertical-align: -0.31em;"></span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right: 0.02778em;">r</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right: 0.01968em;">l</span><span class="mord" style="margin-right: 0.02778em;">_</span><span class="mord mathnormal">t</span><span class="mord mathnormal">ree</span><span class="mclose">]</span><span class="mord">.</span></span></span></span></span></p>
<p><span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mi>e</mi><mi>f</mi><mtext>&nbsp;&nbsp;</mtext><mi>p</mi><mi>r</mi><mi>e</mi><mi>p</mi><mi>e</mi><mi>n</mi><mi>d</mi><mo>:</mo><mo>:</mo><mi>V</mi><mi>a</mi><mi>l</mi><mi>u</mi><mi>e</mi><mtext>&nbsp;&nbsp;</mtext><mi>R</mi><mi>A</mi><mi>L</mi><mo>→</mo><mo stretchy="false">(</mo><mi>m</mi><mi>e</mi><mi>r</mi><mi>g</mi><mi>e</mi><mtext>&nbsp;&nbsp;</mtext><mo stretchy="false">{</mo><mi>l</mi><mi>e</mi><mi>a</mi><mi>f</mi><mo separator="true">,</mo><mi>V</mi><mi>a</mi><mi>l</mi><mi>u</mi><mi>e</mi><mo stretchy="false">}</mo><mtext>&nbsp;&nbsp;</mtext><mi>R</mi><mi>A</mi><mi>L</mi><mo stretchy="false">)</mo><mi mathvariant="normal">.</mi></mrow><annotation encoding="application/x-tex">de\mathit{f} ~ ~ prepend :: Value ~ ~ RAL \rightarrow (merge ~ ~ \lbrace lea\mathit{f}, Value \rbrace ~ ~ RAL).</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathit">f</span><span class="mspace nobreak">&nbsp;</span><span class="mspace nobreak">&nbsp;</span><span class="mord mathnormal">p</span><span class="mord mathnormal">re</span><span class="mord mathnormal">p</span><span class="mord mathnormal">e</span><span class="mord mathnormal">n</span><span class="mord mathnormal">d</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">::</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.69444em; vertical-align: 0em;"></span><span class="mord mathnormal">Va</span><span class="mord mathnormal" style="margin-right: 0.01968em;">l</span><span class="mord mathnormal">u</span><span class="mord mathnormal">e</span><span class="mspace nobreak">&nbsp;</span><span class="mspace nobreak">&nbsp;</span><span class="mord mathnormal" style="margin-right: 0.00773em;">R</span><span class="mord mathnormal">A</span><span class="mord mathnormal">L</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">m</span><span class="mord mathnormal" style="margin-right: 0.02778em;">er</span><span class="mord mathnormal" style="margin-right: 0.03588em;">g</span><span class="mord mathnormal">e</span><span class="mspace nobreak">&nbsp;</span><span class="mspace nobreak">&nbsp;</span><span class="mopen">{</span><span class="mord mathnormal" style="margin-right: 0.01968em;">l</span><span class="mord mathnormal">e</span><span class="mord mathnormal">a</span><span class="mord mathit">f</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathnormal">Va</span><span class="mord mathnormal" style="margin-right: 0.01968em;">l</span><span class="mord mathnormal">u</span><span class="mord mathnormal">e</span><span class="mclose">}</span><span class="mspace nobreak">&nbsp;</span><span class="mspace nobreak">&nbsp;</span><span class="mord mathnormal" style="margin-right: 0.00773em;">R</span><span class="mord mathnormal">A</span><span class="mord mathnormal">L</span><span class="mclose">)</span><span class="mord">.</span></span></span></span></span></p>
</blockquote>
<p>The <code>merge</code> function is responsible for implementing the two rules just like <code>inc</code> was used to implement the two similar rules with the binary sequence.  The <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">{</mo><mi>l</mi><mi>e</mi><mi>a</mi><mi>f</mi><mo separator="true">,</mo><mi>V</mi><mi>a</mi><mi>l</mi><mi>u</mi><mi>e</mi><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">\lbrace leaf, Value \rbrace</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">{</span><span class="mord mathnormal" style="margin-right: 0.01968em;">l</span><span class="mord mathnormal">e</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right: 0.10764em;">f</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathnormal">Va</span><span class="mord mathnormal" style="margin-right: 0.01968em;">l</span><span class="mord mathnormal">u</span><span class="mord mathnormal">e</span><span class="mclose">}</span></span></span></span></span> will be merged (or carried) into the existing RAL (or binary sequence).  Here is the specification and definition for the <code>merge</code> function.  Compare and contrast this with the <code>inc</code> function we wrote earlier.  When we have to merge (or carry over) a tree with an existing tree, we create a new root node and put the carry over tree to the left and the existing tree to the right.  The <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi><mi>o</mi><mi>u</mi><mi>n</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">Count</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord mathnormal" style="margin-right: 0.07153em;">C</span><span class="mord mathnormal">o</span><span class="mord mathnormal">u</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span></span></span></span></span> for the new root node of the tree will be the sum of the counts of the two trees that were merged together.  Refer back to the diagrams earlier to see how this merge was happening as we added a new letter to our RAL.</p>
<blockquote>
<p><span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>p</mi><mi>e</mi><mi>c</mi><mtext>&nbsp;&nbsp;</mtext><mi>m</mi><mi>e</mi><mi>r</mi><mi>g</mi><mi>e</mi><mo>:</mo><mo>:</mo><mi>r</mi><mi>a</mi><mi>l</mi><mi mathvariant="normal">_</mi><mi>t</mi><mi>r</mi><mi>e</mi><mi>e</mi><mtext>&nbsp;&nbsp;</mtext><mo stretchy="false">[</mo><mi>r</mi><mi>a</mi><mi>l</mi><mi mathvariant="normal">_</mi><mi>t</mi><mi>r</mi><mi>e</mi><mi>e</mi><mo stretchy="false">]</mo><mi mathvariant="normal">.</mi></mrow><annotation encoding="application/x-tex">spec ~ ~ merge :: ral\_tree ~ ~ [ral\_tree].</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.625em; vertical-align: -0.19444em;"></span><span class="mord mathnormal">s</span><span class="mord mathnormal">p</span><span class="mord mathnormal">ec</span><span class="mspace nobreak">&nbsp;</span><span class="mspace nobreak">&nbsp;</span><span class="mord mathnormal">m</span><span class="mord mathnormal" style="margin-right: 0.02778em;">er</span><span class="mord mathnormal" style="margin-right: 0.03588em;">g</span><span class="mord mathnormal">e</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">::</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1.06em; vertical-align: -0.31em;"></span><span class="mord mathnormal" style="margin-right: 0.02778em;">r</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right: 0.01968em;">l</span><span class="mord" style="margin-right: 0.02778em;">_</span><span class="mord mathnormal">t</span><span class="mord mathnormal">ree</span><span class="mspace nobreak">&nbsp;</span><span class="mspace nobreak">&nbsp;</span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right: 0.02778em;">r</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right: 0.01968em;">l</span><span class="mord" style="margin-right: 0.02778em;">_</span><span class="mord mathnormal">t</span><span class="mord mathnormal">ree</span><span class="mclose">]</span><span class="mord">.</span></span></span></span></span></p>
<p><span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mi>e</mi><mi>f</mi><mtext>&nbsp;&nbsp;</mtext><mi>m</mi><mi>e</mi><mi>r</mi><mi>g</mi><mi>e</mi><mo>:</mo><mo>:</mo><mi>C</mi><mi>a</mi><mi>r</mi><mi>r</mi><mi>y</mi><mi mathvariant="normal">_</mi><mi>T</mi><mi>r</mi><mi>e</mi><mi>e</mi><mtext>&nbsp;&nbsp;</mtext><mo stretchy="false">[</mo><mo stretchy="false">]</mo><mo>→</mo><mo stretchy="false">[</mo><mi>C</mi><mi>a</mi><mi>r</mi><mi>r</mi><mi>y</mi><mi mathvariant="normal">_</mi><mi>T</mi><mi>r</mi><mi>e</mi><mi>e</mi><mo stretchy="false">]</mo><mo separator="true">;</mo></mrow><annotation encoding="application/x-tex">de\mathit{f} ~ ~ merge :: Carry\_Tree ~ ~ [] \rightarrow [Carry\_Tree];</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathit">f</span><span class="mspace nobreak">&nbsp;</span><span class="mspace nobreak">&nbsp;</span><span class="mord mathnormal">m</span><span class="mord mathnormal" style="margin-right: 0.02778em;">er</span><span class="mord mathnormal" style="margin-right: 0.03588em;">g</span><span class="mord mathnormal">e</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">::</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1.06em; vertical-align: -0.31em;"></span><span class="mord mathnormal" style="margin-right: 0.07153em;">C</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right: 0.03588em;">rry</span><span class="mord" style="margin-right: 0.02778em;">_</span><span class="mord mathnormal" style="margin-right: 0.13889em;">T</span><span class="mord mathnormal">ree</span><span class="mspace nobreak">&nbsp;</span><span class="mspace nobreak">&nbsp;</span><span class="mopen">[</span><span class="mclose">]</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1.06em; vertical-align: -0.31em;"></span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right: 0.07153em;">C</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right: 0.03588em;">rry</span><span class="mord" style="margin-right: 0.02778em;">_</span><span class="mord mathnormal" style="margin-right: 0.13889em;">T</span><span class="mord mathnormal">ree</span><span class="mclose">]</span><span class="mpunct">;</span></span></span></span></span><br>
<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mi>e</mi><mi>f</mi><mtext>&nbsp;&nbsp;</mtext><mi>m</mi><mi>e</mi><mi>r</mi><mi>g</mi><mi>e</mi><mo>:</mo><mo>:</mo><mi>C</mi><mi>a</mi><mi>r</mi><mi>r</mi><mi>y</mi><mi mathvariant="normal">_</mi><mi>T</mi><mi>r</mi><mi>e</mi><mi>e</mi><mtext>&nbsp;&nbsp;</mtext><mo stretchy="false">[</mo><mi>n</mi><mi>i</mi><mi>l</mi><mi mathvariant="normal">∣</mi><mi>R</mi><mi>e</mi><mi>s</mi><mi>t</mi><mi mathvariant="normal">_</mi><mi>T</mi><mi>r</mi><mi>e</mi><mi>e</mi><mi>s</mi><mo stretchy="false">]</mo><mo stretchy="false">)</mo><mo>→</mo><mo stretchy="false">[</mo><mi>C</mi><mi>a</mi><mi>r</mi><mi>r</mi><mi>y</mi><mi mathvariant="normal">_</mi><mi>T</mi><mi>r</mi><mi>e</mi><mi>e</mi><mi mathvariant="normal">∣</mi><mi>R</mi><mi>e</mi><mi>s</mi><mi>t</mi><mi mathvariant="normal">_</mi><mi>T</mi><mi>r</mi><mi>e</mi><mi>e</mi><mi>s</mi><mo stretchy="false">]</mo><mo separator="true">;</mo></mrow><annotation encoding="application/x-tex">de\mathit{f} ~ ~ merge :: Carry\_Tree ~ ~ [nil|Rest\_Trees]) \rightarrow [Carry\_Tree|Rest\_Trees];</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathit">f</span><span class="mspace nobreak">&nbsp;</span><span class="mspace nobreak">&nbsp;</span><span class="mord mathnormal">m</span><span class="mord mathnormal" style="margin-right: 0.02778em;">er</span><span class="mord mathnormal" style="margin-right: 0.03588em;">g</span><span class="mord mathnormal">e</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">::</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1.06em; vertical-align: -0.31em;"></span><span class="mord mathnormal" style="margin-right: 0.07153em;">C</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right: 0.03588em;">rry</span><span class="mord" style="margin-right: 0.02778em;">_</span><span class="mord mathnormal" style="margin-right: 0.13889em;">T</span><span class="mord mathnormal">ree</span><span class="mspace nobreak">&nbsp;</span><span class="mspace nobreak">&nbsp;</span><span class="mopen">[</span><span class="mord mathnormal">ni</span><span class="mord mathnormal" style="margin-right: 0.01968em;">l</span><span class="mord">∣</span><span class="mord mathnormal" style="margin-right: 0.00773em;">R</span><span class="mord mathnormal">es</span><span class="mord mathnormal">t</span><span class="mord" style="margin-right: 0.02778em;">_</span><span class="mord mathnormal" style="margin-right: 0.13889em;">T</span><span class="mord mathnormal">rees</span><span class="mclose">])</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1.06em; vertical-align: -0.31em;"></span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right: 0.07153em;">C</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right: 0.03588em;">rry</span><span class="mord" style="margin-right: 0.02778em;">_</span><span class="mord mathnormal" style="margin-right: 0.13889em;">T</span><span class="mord mathnormal">ree</span><span class="mord">∣</span><span class="mord mathnormal" style="margin-right: 0.00773em;">R</span><span class="mord mathnormal">es</span><span class="mord mathnormal">t</span><span class="mord" style="margin-right: 0.02778em;">_</span><span class="mord mathnormal" style="margin-right: 0.13889em;">T</span><span class="mord mathnormal">rees</span><span class="mclose">]</span><span class="mpunct">;</span></span></span></span></span><br>
<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mi>e</mi><mi>f</mi><mtext>&nbsp;&nbsp;</mtext><mi>m</mi><mi>e</mi><mi>r</mi><mi>g</mi><mi>e</mi><mo>:</mo><mo>:</mo><mi>C</mi><mi>a</mi><mi>r</mi><mi>r</mi><mi>y</mi><mi mathvariant="normal">_</mi><mi>T</mi><mi>r</mi><mi>e</mi><mi>e</mi><mtext>&nbsp;&nbsp;</mtext><mo stretchy="false">[</mo><mi>T</mi><mi>r</mi><mi>e</mi><mi>e</mi><mi mathvariant="normal">∣</mi><mi>R</mi><mi>e</mi><mi>s</mi><mi>t</mi><mi mathvariant="normal">_</mi><mi>T</mi><mi>r</mi><mi>e</mi><mi>e</mi><mi>s</mi><mo stretchy="false">]</mo><mo stretchy="false">)</mo><mo>→</mo></mrow><annotation encoding="application/x-tex">de\mathit{f} ~ ~ merge :: Carry\_Tree ~ ~ [Tree|Rest\_Trees]) \rightarrow</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathit">f</span><span class="mspace nobreak">&nbsp;</span><span class="mspace nobreak">&nbsp;</span><span class="mord mathnormal">m</span><span class="mord mathnormal" style="margin-right: 0.02778em;">er</span><span class="mord mathnormal" style="margin-right: 0.03588em;">g</span><span class="mord mathnormal">e</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">::</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1.06em; vertical-align: -0.31em;"></span><span class="mord mathnormal" style="margin-right: 0.07153em;">C</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right: 0.03588em;">rry</span><span class="mord" style="margin-right: 0.02778em;">_</span><span class="mord mathnormal" style="margin-right: 0.13889em;">T</span><span class="mord mathnormal">ree</span><span class="mspace nobreak">&nbsp;</span><span class="mspace nobreak">&nbsp;</span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right: 0.13889em;">T</span><span class="mord mathnormal">ree</span><span class="mord">∣</span><span class="mord mathnormal" style="margin-right: 0.00773em;">R</span><span class="mord mathnormal">es</span><span class="mord mathnormal">t</span><span class="mord" style="margin-right: 0.02778em;">_</span><span class="mord mathnormal" style="margin-right: 0.13889em;">T</span><span class="mord mathnormal">rees</span><span class="mclose">])</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">→</span></span></span></span></span><br>
<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mspace width="2em"></mspace><mi>M</mi><mi>e</mi><mi>r</mi><mi>g</mi><mi>e</mi><mi>d</mi><mi mathvariant="normal">_</mi><mi>T</mi><mi>r</mi><mi>e</mi><mi>e</mi><mo>=</mo><mo stretchy="false">{</mo><mi>l</mi><mi>e</mi><mi>f</mi><mi>t</mi><mi mathvariant="normal">_</mi><mi>a</mi><mi>s</mi><mi mathvariant="normal">_</mi><mi>a</mi><mi>n</mi><mi mathvariant="normal">_</mi><mi>e</mi><mi>x</mi><mi>e</mi><mi>r</mi><mi>c</mi><mi>i</mi><mi>s</mi><mi>e</mi><mo stretchy="false">}</mo><mo separator="true">,</mo></mrow><annotation encoding="application/x-tex">\kern{2em}Merged\_Tree = \lbrace left\_as\_an\_exercise \rbrace,</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1.00444em; vertical-align: -0.31em;"></span><span class="mspace" style="margin-right: 2em;"></span><span class="mord mathnormal" style="margin-right: 0.10903em;">M</span><span class="mord mathnormal" style="margin-right: 0.02778em;">er</span><span class="mord mathnormal" style="margin-right: 0.03588em;">g</span><span class="mord mathnormal">e</span><span class="mord mathnormal">d</span><span class="mord" style="margin-right: 0.02778em;">_</span><span class="mord mathnormal" style="margin-right: 0.13889em;">T</span><span class="mord mathnormal">ree</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1.06em; vertical-align: -0.31em;"></span><span class="mopen">{</span><span class="mord mathnormal" style="margin-right: 0.01968em;">l</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right: 0.10764em;">f</span><span class="mord mathnormal">t</span><span class="mord" style="margin-right: 0.02778em;">_</span><span class="mord mathnormal">a</span><span class="mord mathnormal">s</span><span class="mord" style="margin-right: 0.02778em;">_</span><span class="mord mathnormal">an</span><span class="mord" style="margin-right: 0.02778em;">_</span><span class="mord mathnormal">e</span><span class="mord mathnormal">x</span><span class="mord mathnormal">erc</span><span class="mord mathnormal">i</span><span class="mord mathnormal">se</span><span class="mclose">}</span><span class="mpunct">,</span></span></span></span></span><br>
<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mspace width="2em"></mspace><mo stretchy="false">[</mo><mi>n</mi><mi>i</mi><mi>l</mi><mi mathvariant="normal">∣</mi><mo stretchy="false">(</mo><mi>m</mi><mi>e</mi><mi>r</mi><mi>g</mi><mi>e</mi><mtext>&nbsp;&nbsp;</mtext><mi>M</mi><mi>e</mi><mi>r</mi><mi>g</mi><mi>e</mi><mi>d</mi><mi mathvariant="normal">_</mi><mi>T</mi><mi>r</mi><mi>e</mi><mi>e</mi><mtext>&nbsp;&nbsp;</mtext><mi>R</mi><mi>e</mi><mi>s</mi><mi>t</mi><mi mathvariant="normal">_</mi><mi>T</mi><mi>r</mi><mi>e</mi><mi>e</mi><mi>s</mi><mo stretchy="false">]</mo><mi mathvariant="normal">.</mi></mrow><annotation encoding="application/x-tex">\kern{2em}[nil|(merge ~ ~ Merged\_Tree ~ ~ Rest\_Trees].</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1.06em; vertical-align: -0.31em;"></span><span class="mspace" style="margin-right: 2em;"></span><span class="mopen">[</span><span class="mord mathnormal">ni</span><span class="mord mathnormal" style="margin-right: 0.01968em;">l</span><span class="mord">∣</span><span class="mopen">(</span><span class="mord mathnormal">m</span><span class="mord mathnormal" style="margin-right: 0.02778em;">er</span><span class="mord mathnormal" style="margin-right: 0.03588em;">g</span><span class="mord mathnormal">e</span><span class="mspace nobreak">&nbsp;</span><span class="mspace nobreak">&nbsp;</span><span class="mord mathnormal" style="margin-right: 0.10903em;">M</span><span class="mord mathnormal" style="margin-right: 0.02778em;">er</span><span class="mord mathnormal" style="margin-right: 0.03588em;">g</span><span class="mord mathnormal">e</span><span class="mord mathnormal">d</span><span class="mord" style="margin-right: 0.02778em;">_</span><span class="mord mathnormal" style="margin-right: 0.13889em;">T</span><span class="mord mathnormal">ree</span><span class="mspace nobreak">&nbsp;</span><span class="mspace nobreak">&nbsp;</span><span class="mord mathnormal" style="margin-right: 0.00773em;">R</span><span class="mord mathnormal">es</span><span class="mord mathnormal">t</span><span class="mord" style="margin-right: 0.02778em;">_</span><span class="mord mathnormal" style="margin-right: 0.13889em;">T</span><span class="mord mathnormal">rees</span><span class="mclose">]</span><span class="mord">.</span></span></span></span></span></p>
</blockquote>
<p>The <code>count</code> function used above will either return 1 for a leaf or the <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi><mi>o</mi><mi>u</mi><mi>n</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">Count</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord mathnormal" style="margin-right: 0.07153em;">C</span><span class="mord mathnormal">o</span><span class="mord mathnormal">u</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span></span></span></span></span> value from the <code>ral_tree</code> structure.  The implementations of all of these functions in Erlang is left for an exercise.</p>
<h2 id="problem-set-1">Problem Set 1</h2>
<ol>
<li>Implement the <code>prepend</code>,  <code>merge</code>, and <code>count</code> functions as described above.  The specification and definition for <code>prepend</code> and <code>merge</code> are provided.  You will need complete the definition for <code>merge</code> by determining what <code>Merged_Tree</code> should be equal to.  The specification and definition for <code>count</code> is not provided but it is described at the end of the reading above.  Use the test code provided to verify your implementation.</li>
</ol>
<h2 id="part-2---lookup-and-update">Part 2 - Lookup and Update</h2>
<p>Finding a specific value in the RAL relies on the relation to the binary sequence that we started with.  The diagram below shows the RAL with 7 items (111 binary sequence).  In this diagram, the numbers in the non-leaf nodes show the value of <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi><mi>o</mi><mi>u</mi><mi>n</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">Count</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord mathnormal" style="margin-right: 0.07153em;">C</span><span class="mord mathnormal">o</span><span class="mord mathnormal">u</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span></span></span></span></span> (remember a leaf node has a <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi><mi>o</mi><mi>u</mi><mi>n</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">Count</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord mathnormal" style="margin-right: 0.07153em;">C</span><span class="mord mathnormal">o</span><span class="mord mathnormal">u</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span></span></span></span></span> of 1).  The boxes in the list are also annotated with the power of 2 that they represent.  Note that the power of 2 represents the number of leaves in the <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><mi>a</mi><mi>l</mi><mi mathvariant="normal">_</mi><mi>t</mi><mi>r</mi><mi>e</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">ral\_tree</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1.00444em; vertical-align: -0.31em;"></span><span class="mord mathnormal" style="margin-right: 0.02778em;">r</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right: 0.01968em;">l</span><span class="mord" style="margin-right: 0.02778em;">_</span><span class="mord mathnormal">t</span><span class="mord mathnormal">ree</span></span></span></span></span>.</p>
<p><img src="https://macbeth-byui.github.io/cse382-course/images/ral7_counting.drawio.png" alt="ral 7 counting"></p>
<p>If we wanted to find the 5th number (index 4) in the RAL (where the G in the first leaf on the left is considered index 0), then we first need to traverse the list to find the correct <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><mi>a</mi><mi>l</mi><mi mathvariant="normal">_</mi><mi>t</mi><mi>r</mi><mi>e</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">ral\_tree</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1.00444em; vertical-align: -0.31em;"></span><span class="mord mathnormal" style="margin-right: 0.02778em;">r</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right: 0.01968em;">l</span><span class="mord" style="margin-right: 0.02778em;">_</span><span class="mord mathnormal">t</span><span class="mord mathnormal">ree</span></span></span></span></span>.  If we start at the first <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><mi>a</mi><mi>l</mi><mi mathvariant="normal">_</mi><mi>t</mi><mi>r</mi><mi>e</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">ral\_tree</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1.00444em; vertical-align: -0.31em;"></span><span class="mord mathnormal" style="margin-right: 0.02778em;">r</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right: 0.01968em;">l</span><span class="mord" style="margin-right: 0.02778em;">_</span><span class="mord mathnormal">t</span><span class="mord mathnormal">ree</span></span></span></span></span>, we see that the <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi><mi>o</mi><mi>u</mi><mi>n</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">Count</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord mathnormal" style="margin-right: 0.07153em;">C</span><span class="mord mathnormal">o</span><span class="mord mathnormal">u</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span></span></span></span></span> is 1 which means there is only 1 value in this first <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><mi>a</mi><mi>l</mi><mi mathvariant="normal">_</mi><mi>t</mi><mi>r</mi><mi>e</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">ral\_tree</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1.00444em; vertical-align: -0.31em;"></span><span class="mord mathnormal" style="margin-right: 0.02778em;">r</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right: 0.01968em;">l</span><span class="mord" style="margin-right: 0.02778em;">_</span><span class="mord mathnormal">t</span><span class="mord mathnormal">ree</span></span></span></span></span>.  Index 4 is not in this <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><mi>a</mi><mi>l</mi><mi mathvariant="normal">_</mi><mi>t</mi><mi>r</mi><mi>e</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">ral\_tree</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1.00444em; vertical-align: -0.31em;"></span><span class="mord mathnormal" style="margin-right: 0.02778em;">r</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right: 0.01968em;">l</span><span class="mord" style="margin-right: 0.02778em;">_</span><span class="mord mathnormal">t</span><span class="mord mathnormal">ree</span></span></span></span></span>.  We will subtract 1 from our Index and keep moving.</p>
<p><img src="https://macbeth-byui.github.io/cse382-course/images/ral7_counting_step2.drawio.png" alt="ral 7 counting step 2"></p>
<p>We then consider whether the value we are looking for is within the 2nd node of the RAL.  Our updated index of 3 is <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>≥</mo></mrow><annotation encoding="application/x-tex">\geq</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.77194em; vertical-align: -0.13597em;"></span><span class="mrel">≥</span></span></span></span></span> to <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><mn>1</mn></msup></mrow><annotation encoding="application/x-tex">2^1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.814108em; vertical-align: 0em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.814108em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span></span></span></span></span></span></span></span></span> so we subtract <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><mn>1</mn></msup></mrow><annotation encoding="application/x-tex">2^1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.814108em; vertical-align: 0em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.814108em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span></span></span></span></span></span></span></span></span> from our index and move on.</p>
<p><img src="https://macbeth-byui.github.io/cse382-course/images/ral7_counting_step3.drawio.png" alt="ral 7 counting step 3"></p>
<p>We then consider whether the value we are looking for is within the 3rd node of the RAL.  Our updated index of 1 is not <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>≥</mo></mrow><annotation encoding="application/x-tex">\geq</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.77194em; vertical-align: -0.13597em;"></span><span class="mrel">≥</span></span></span></span></span> to <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">2^2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.814108em; vertical-align: 0em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.814108em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></span>.  Therefore we know that the value we are looking for is somewhere within the this 3rd <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><mi>a</mi><mi>l</mi><mi mathvariant="normal">_</mi><mi>l</mi><mi>i</mi><mi>s</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">ral\_list</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1.00444em; vertical-align: -0.31em;"></span><span class="mord mathnormal" style="margin-right: 0.02778em;">r</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right: 0.01968em;">l</span><span class="mord" style="margin-right: 0.02778em;">_</span><span class="mord mathnormal" style="margin-right: 0.01968em;">l</span><span class="mord mathnormal">i</span><span class="mord mathnormal">s</span><span class="mord mathnormal">t</span></span></span></span></span>.</p>
<p>The specification and definition for the lookup function is give below.  Note that the <code>lookup_in_tree</code> function is used to find the desired value (i.e. leaf) in the <code>ral_tree</code>.</p>
<blockquote>
<p><span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>p</mi><mi>e</mi><mi>c</mi><mtext>&nbsp;&nbsp;</mtext><mi>l</mi><mi>o</mi><mi>o</mi><mi>k</mi><mi>u</mi><mi>p</mi><mo>:</mo><mo>:</mo><mi>i</mi><mi>n</mi><mi>t</mi><mi>e</mi><mi>g</mi><mi>e</mi><mi>r</mi><mtext>&nbsp;&nbsp;</mtext><mo stretchy="false">[</mo><mi>r</mi><mi>a</mi><mi>l</mi><mi mathvariant="normal">_</mi><mi>t</mi><mi>r</mi><mi>e</mi><mi>e</mi><mo stretchy="false">]</mo><mo>→</mo><mi>a</mi><mi mathvariant="normal">.</mi></mrow><annotation encoding="application/x-tex">spec ~ ~ lookup :: integer ~ ~ [ral\_tree] \rightarrow a.</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span class="mord mathnormal">s</span><span class="mord mathnormal">p</span><span class="mord mathnormal">ec</span><span class="mspace nobreak">&nbsp;</span><span class="mspace nobreak">&nbsp;</span><span class="mord mathnormal" style="margin-right: 0.01968em;">l</span><span class="mord mathnormal">oo</span><span class="mord mathnormal" style="margin-right: 0.03148em;">k</span><span class="mord mathnormal">u</span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">::</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1.06em; vertical-align: -0.31em;"></span><span class="mord mathnormal">in</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right: 0.03588em;">g</span><span class="mord mathnormal" style="margin-right: 0.02778em;">er</span><span class="mspace nobreak">&nbsp;</span><span class="mspace nobreak">&nbsp;</span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right: 0.02778em;">r</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right: 0.01968em;">l</span><span class="mord" style="margin-right: 0.02778em;">_</span><span class="mord mathnormal">t</span><span class="mord mathnormal">ree</span><span class="mclose">]</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.43056em; vertical-align: 0em;"></span><span class="mord mathnormal">a</span><span class="mord">.</span></span></span></span></span></p>
<p><span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mi>e</mi><mi>f</mi><mtext>&nbsp;&nbsp;</mtext><mi>l</mi><mi>o</mi><mi>o</mi><mi>k</mi><mi>u</mi><mi>p</mi><mo>:</mo><mo>:</mo><mi>I</mi><mi>n</mi><mi>d</mi><mi>e</mi><mi>x</mi><mtext>&nbsp;&nbsp;</mtext><mi>R</mi><mi>A</mi><mi>L</mi><mo>→</mo><mi>n</mi><mi>i</mi><mi>l</mi><mtext>&nbsp;&nbsp;when&nbsp;&nbsp;</mtext><mi>I</mi><mi>n</mi><mi>d</mi><mi>e</mi><mi>x</mi><mo>&lt;</mo><mn>0</mn><mo separator="true">;</mo></mrow><annotation encoding="application/x-tex">de\mathit{f} ~ ~ lookup :: Index ~ ~ RAL \rightarrow nil ~ ~ \text{when} ~ ~ Index \lt 0;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathit">f</span><span class="mspace nobreak">&nbsp;</span><span class="mspace nobreak">&nbsp;</span><span class="mord mathnormal" style="margin-right: 0.01968em;">l</span><span class="mord mathnormal">oo</span><span class="mord mathnormal" style="margin-right: 0.03148em;">k</span><span class="mord mathnormal">u</span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">::</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.69444em; vertical-align: 0em;"></span><span class="mord mathnormal" style="margin-right: 0.07847em;">I</span><span class="mord mathnormal">n</span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathnormal">x</span><span class="mspace nobreak">&nbsp;</span><span class="mspace nobreak">&nbsp;</span><span class="mord mathnormal" style="margin-right: 0.00773em;">R</span><span class="mord mathnormal">A</span><span class="mord mathnormal">L</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.73354em; vertical-align: -0.0391em;"></span><span class="mord mathnormal">ni</span><span class="mord mathnormal" style="margin-right: 0.01968em;">l</span><span class="mspace nobreak">&nbsp;</span><span class="mspace nobreak">&nbsp;</span><span class="mord text"><span class="mord">when</span></span><span class="mspace nobreak">&nbsp;</span><span class="mspace nobreak">&nbsp;</span><span class="mord mathnormal" style="margin-right: 0.07847em;">I</span><span class="mord mathnormal">n</span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.83888em; vertical-align: -0.19444em;"></span><span class="mord">0</span><span class="mpunct">;</span></span></span></span></span><br>
<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mi>e</mi><mi>f</mi><mtext>&nbsp;&nbsp;</mtext><mi>l</mi><mi>o</mi><mi>o</mi><mi>k</mi><mi>u</mi><mi>p</mi><mo>:</mo><mo>:</mo><mi>I</mi><mi>n</mi><mi>d</mi><mi>e</mi><mi>x</mi><mtext>&nbsp;&nbsp;</mtext><mo stretchy="false">[</mo><mo stretchy="false">]</mo><mo>→</mo><mi>n</mi><mi>i</mi><mi>l</mi><mo separator="true">;</mo></mrow><annotation encoding="application/x-tex">de\mathit{f} ~ ~ lookup :: Index ~ ~ [] \rightarrow nil;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathit">f</span><span class="mspace nobreak">&nbsp;</span><span class="mspace nobreak">&nbsp;</span><span class="mord mathnormal" style="margin-right: 0.01968em;">l</span><span class="mord mathnormal">oo</span><span class="mord mathnormal" style="margin-right: 0.03148em;">k</span><span class="mord mathnormal">u</span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">::</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal" style="margin-right: 0.07847em;">I</span><span class="mord mathnormal">n</span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathnormal">x</span><span class="mspace nobreak">&nbsp;</span><span class="mspace nobreak">&nbsp;</span><span class="mopen">[</span><span class="mclose">]</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span class="mord mathnormal">ni</span><span class="mord mathnormal" style="margin-right: 0.01968em;">l</span><span class="mpunct">;</span></span></span></span></span><br>
<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mi>e</mi><mi>f</mi><mtext>&nbsp;&nbsp;</mtext><mi>l</mi><mi>o</mi><mi>o</mi><mi>k</mi><mi>u</mi><mi>p</mi><mo>:</mo><mo>:</mo><mi>I</mi><mi>n</mi><mi>d</mi><mi>e</mi><mi>x</mi><mtext>&nbsp;&nbsp;</mtext><mo stretchy="false">[</mo><mi>n</mi><mi>i</mi><mi>l</mi><mi mathvariant="normal">∣</mi><mi>R</mi><mi>e</mi><mi>s</mi><mi>t</mi><mi mathvariant="normal">_</mi><mi>T</mi><mi>r</mi><mi>e</mi><mi>e</mi><mi>s</mi><mo stretchy="false">]</mo><mo>→</mo><mo stretchy="false">(</mo><mi>l</mi><mi>o</mi><mi>o</mi><mi>k</mi><mi>u</mi><mi>p</mi><mtext>&nbsp;&nbsp;</mtext><mi>I</mi><mi>n</mi><mi>d</mi><mi>e</mi><mi>x</mi><mtext>&nbsp;&nbsp;</mtext><mi>R</mi><mi>e</mi><mi>s</mi><mi>t</mi><mi mathvariant="normal">_</mi><mi>T</mi><mi>r</mi><mi>e</mi><mi>e</mi><mi>s</mi><mo stretchy="false">)</mo><mo separator="true">;</mo></mrow><annotation encoding="application/x-tex">de\mathit{f} ~ ~ lookup :: Index ~ ~ [nil|Rest\_Trees] \rightarrow (lookup ~ ~ Index ~ ~ Rest\_Trees);</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathit">f</span><span class="mspace nobreak">&nbsp;</span><span class="mspace nobreak">&nbsp;</span><span class="mord mathnormal" style="margin-right: 0.01968em;">l</span><span class="mord mathnormal">oo</span><span class="mord mathnormal" style="margin-right: 0.03148em;">k</span><span class="mord mathnormal">u</span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">::</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1.06em; vertical-align: -0.31em;"></span><span class="mord mathnormal" style="margin-right: 0.07847em;">I</span><span class="mord mathnormal">n</span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathnormal">x</span><span class="mspace nobreak">&nbsp;</span><span class="mspace nobreak">&nbsp;</span><span class="mopen">[</span><span class="mord mathnormal">ni</span><span class="mord mathnormal" style="margin-right: 0.01968em;">l</span><span class="mord">∣</span><span class="mord mathnormal" style="margin-right: 0.00773em;">R</span><span class="mord mathnormal">es</span><span class="mord mathnormal">t</span><span class="mord" style="margin-right: 0.02778em;">_</span><span class="mord mathnormal" style="margin-right: 0.13889em;">T</span><span class="mord mathnormal">rees</span><span class="mclose">]</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1.06em; vertical-align: -0.31em;"></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right: 0.01968em;">l</span><span class="mord mathnormal">oo</span><span class="mord mathnormal" style="margin-right: 0.03148em;">k</span><span class="mord mathnormal">u</span><span class="mord mathnormal">p</span><span class="mspace nobreak">&nbsp;</span><span class="mspace nobreak">&nbsp;</span><span class="mord mathnormal" style="margin-right: 0.07847em;">I</span><span class="mord mathnormal">n</span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathnormal">x</span><span class="mspace nobreak">&nbsp;</span><span class="mspace nobreak">&nbsp;</span><span class="mord mathnormal" style="margin-right: 0.00773em;">R</span><span class="mord mathnormal">es</span><span class="mord mathnormal">t</span><span class="mord" style="margin-right: 0.02778em;">_</span><span class="mord mathnormal" style="margin-right: 0.13889em;">T</span><span class="mord mathnormal">rees</span><span class="mclose">)</span><span class="mpunct">;</span></span></span></span></span><br>
<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mi>e</mi><mi>f</mi><mtext>&nbsp;&nbsp;</mtext><mi>l</mi><mi>o</mi><mi>o</mi><mi>k</mi><mi>u</mi><mi>p</mi><mo>:</mo><mo>:</mo><mi>I</mi><mi>n</mi><mi>d</mi><mi>e</mi><mi>x</mi><mtext>&nbsp;&nbsp;</mtext><mo stretchy="false">[</mo><mi>T</mi><mi>r</mi><mi>e</mi><mi>e</mi><mi mathvariant="normal">∣</mi><mi>R</mi><mi>e</mi><mi>s</mi><mi>t</mi><mi mathvariant="normal">_</mi><mi>T</mi><mi>r</mi><mi>e</mi><mi>e</mi><mi>s</mi><mo stretchy="false">]</mo><mo>→</mo><mo stretchy="false">(</mo><mi>l</mi><mi>o</mi><mi>o</mi><mi>k</mi><mi>u</mi><mi>p</mi><mtext>&nbsp;&nbsp;</mtext><mi>I</mi><mi>n</mi><mi>d</mi><mi>e</mi><mi>x</mi><mo>−</mo><mo stretchy="false">(</mo><mi>c</mi><mi>o</mi><mi>u</mi><mi>n</mi><mi>t</mi><mtext>&nbsp;&nbsp;</mtext><mi>T</mi><mi>r</mi><mi>e</mi><mi>e</mi><mo stretchy="false">)</mo><mtext>&nbsp;&nbsp;</mtext><mi>R</mi><mi>e</mi><mi>s</mi><mi>t</mi><mi mathvariant="normal">_</mi><mi>T</mi><mi>r</mi><mi>e</mi><mi>e</mi><mi>s</mi><mo stretchy="false">)</mo><mtext>&nbsp;&nbsp;when&nbsp;&nbsp;</mtext><mi>I</mi><mi>n</mi><mi>d</mi><mi>e</mi><mi>x</mi><mo>≥</mo><mo stretchy="false">(</mo><mi>c</mi><mi>o</mi><mi>u</mi><mi>n</mi><mi>t</mi><mtext>&nbsp;&nbsp;</mtext><mi>T</mi><mi>r</mi><mi>e</mi><mi>e</mi><mo stretchy="false">)</mo><mo separator="true">;</mo></mrow><annotation encoding="application/x-tex">de\mathit{f} ~ ~ lookup :: Index ~ ~ [Tree|Rest\_Trees] \rightarrow (lookup ~ ~ Index-(count ~ ~ Tree) ~ ~ Rest\_Trees) ~ ~ \text{when} ~ ~ Index \geq (count ~ ~ Tree);</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathit">f</span><span class="mspace nobreak">&nbsp;</span><span class="mspace nobreak">&nbsp;</span><span class="mord mathnormal" style="margin-right: 0.01968em;">l</span><span class="mord mathnormal">oo</span><span class="mord mathnormal" style="margin-right: 0.03148em;">k</span><span class="mord mathnormal">u</span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">::</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1.06em; vertical-align: -0.31em;"></span><span class="mord mathnormal" style="margin-right: 0.07847em;">I</span><span class="mord mathnormal">n</span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathnormal">x</span><span class="mspace nobreak">&nbsp;</span><span class="mspace nobreak">&nbsp;</span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right: 0.13889em;">T</span><span class="mord mathnormal">ree</span><span class="mord">∣</span><span class="mord mathnormal" style="margin-right: 0.00773em;">R</span><span class="mord mathnormal">es</span><span class="mord mathnormal">t</span><span class="mord" style="margin-right: 0.02778em;">_</span><span class="mord mathnormal" style="margin-right: 0.13889em;">T</span><span class="mord mathnormal">rees</span><span class="mclose">]</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right: 0.01968em;">l</span><span class="mord mathnormal">oo</span><span class="mord mathnormal" style="margin-right: 0.03148em;">k</span><span class="mord mathnormal">u</span><span class="mord mathnormal">p</span><span class="mspace nobreak">&nbsp;</span><span class="mspace nobreak">&nbsp;</span><span class="mord mathnormal" style="margin-right: 0.07847em;">I</span><span class="mord mathnormal">n</span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1.06em; vertical-align: -0.31em;"></span><span class="mopen">(</span><span class="mord mathnormal">co</span><span class="mord mathnormal">u</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span><span class="mspace nobreak">&nbsp;</span><span class="mspace nobreak">&nbsp;</span><span class="mord mathnormal" style="margin-right: 0.13889em;">T</span><span class="mord mathnormal">ree</span><span class="mclose">)</span><span class="mspace nobreak">&nbsp;</span><span class="mspace nobreak">&nbsp;</span><span class="mord mathnormal" style="margin-right: 0.00773em;">R</span><span class="mord mathnormal">es</span><span class="mord mathnormal">t</span><span class="mord" style="margin-right: 0.02778em;">_</span><span class="mord mathnormal" style="margin-right: 0.13889em;">T</span><span class="mord mathnormal">rees</span><span class="mclose">)</span><span class="mspace nobreak">&nbsp;</span><span class="mspace nobreak">&nbsp;</span><span class="mord text"><span class="mord">when</span></span><span class="mspace nobreak">&nbsp;</span><span class="mspace nobreak">&nbsp;</span><span class="mord mathnormal" style="margin-right: 0.07847em;">I</span><span class="mord mathnormal">n</span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">≥</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">co</span><span class="mord mathnormal">u</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span><span class="mspace nobreak">&nbsp;</span><span class="mspace nobreak">&nbsp;</span><span class="mord mathnormal" style="margin-right: 0.13889em;">T</span><span class="mord mathnormal">ree</span><span class="mclose">)</span><span class="mpunct">;</span></span></span></span></span><br>
<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mi>e</mi><mi>f</mi><mtext>&nbsp;&nbsp;</mtext><mi>l</mi><mi>o</mi><mi>o</mi><mi>k</mi><mi>u</mi><mi>p</mi><mo>:</mo><mo>:</mo><mi>I</mi><mi>n</mi><mi>d</mi><mi>e</mi><mi>x</mi><mtext>&nbsp;&nbsp;</mtext><mo stretchy="false">[</mo><mi>T</mi><mi>r</mi><mi>e</mi><mi>e</mi><mi mathvariant="normal">∣</mi><mi>R</mi><mi>e</mi><mi>s</mi><mi>t</mi><mi mathvariant="normal">_</mi><mi>T</mi><mi>r</mi><mi>e</mi><mi>e</mi><mi>s</mi><mo stretchy="false">]</mo><mo>→</mo><mo stretchy="false">(</mo><mi>l</mi><mi>o</mi><mi>o</mi><mi>k</mi><mi>u</mi><mi>p</mi><mi mathvariant="normal">_</mi><mi>i</mi><mi>n</mi><mi mathvariant="normal">_</mi><mi>t</mi><mi>r</mi><mi>e</mi><mi>e</mi><mtext>&nbsp;&nbsp;</mtext><mi>I</mi><mi>n</mi><mi>d</mi><mi>e</mi><mi>x</mi><mtext>&nbsp;&nbsp;</mtext><mi>T</mi><mi>r</mi><mi>e</mi><mi>e</mi><mo stretchy="false">)</mo><mi mathvariant="normal">.</mi></mrow><annotation encoding="application/x-tex">de\mathit{f} ~ ~ lookup :: Index ~ ~ [Tree|Rest\_Trees] \rightarrow (lookup\_in\_tree ~ ~ Index ~ ~ Tree).</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathit">f</span><span class="mspace nobreak">&nbsp;</span><span class="mspace nobreak">&nbsp;</span><span class="mord mathnormal" style="margin-right: 0.01968em;">l</span><span class="mord mathnormal">oo</span><span class="mord mathnormal" style="margin-right: 0.03148em;">k</span><span class="mord mathnormal">u</span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">::</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1.06em; vertical-align: -0.31em;"></span><span class="mord mathnormal" style="margin-right: 0.07847em;">I</span><span class="mord mathnormal">n</span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathnormal">x</span><span class="mspace nobreak">&nbsp;</span><span class="mspace nobreak">&nbsp;</span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right: 0.13889em;">T</span><span class="mord mathnormal">ree</span><span class="mord">∣</span><span class="mord mathnormal" style="margin-right: 0.00773em;">R</span><span class="mord mathnormal">es</span><span class="mord mathnormal">t</span><span class="mord" style="margin-right: 0.02778em;">_</span><span class="mord mathnormal" style="margin-right: 0.13889em;">T</span><span class="mord mathnormal">rees</span><span class="mclose">]</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1.06em; vertical-align: -0.31em;"></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right: 0.01968em;">l</span><span class="mord mathnormal">oo</span><span class="mord mathnormal" style="margin-right: 0.03148em;">k</span><span class="mord mathnormal">u</span><span class="mord mathnormal">p</span><span class="mord" style="margin-right: 0.02778em;">_</span><span class="mord mathnormal">in</span><span class="mord" style="margin-right: 0.02778em;">_</span><span class="mord mathnormal">t</span><span class="mord mathnormal">ree</span><span class="mspace nobreak">&nbsp;</span><span class="mspace nobreak">&nbsp;</span><span class="mord mathnormal" style="margin-right: 0.07847em;">I</span><span class="mord mathnormal">n</span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathnormal">x</span><span class="mspace nobreak">&nbsp;</span><span class="mspace nobreak">&nbsp;</span><span class="mord mathnormal" style="margin-right: 0.13889em;">T</span><span class="mord mathnormal">ree</span><span class="mclose">)</span><span class="mord">.</span></span></span></span></span></p>
</blockquote>
<p>In the definition, the first two clauses handle invalid index scenarios.  The third clause handles the case where as we are going through the RAL list, we come across a <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><mi>a</mi><mi>l</mi><mi mathvariant="normal">_</mi><mi>t</mi><mi>r</mi><mi>e</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">ral\_tree</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1.00444em; vertical-align: -0.31em;"></span><span class="mord mathnormal" style="margin-right: 0.02778em;">r</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right: 0.01968em;">l</span><span class="mord" style="margin-right: 0.02778em;">_</span><span class="mord mathnormal">t</span><span class="mord mathnormal">ree</span></span></span></span></span> that is <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mi>i</mi><mi>l</mi></mrow><annotation encoding="application/x-tex">nil</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.69444em; vertical-align: 0em;"></span><span class="mord mathnormal">ni</span><span class="mord mathnormal" style="margin-right: 0.01968em;">l</span></span></span></span></span>.  We know there are no values in there, so we keep going.  Notice that we don’t decrease our <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>I</mi><mi>n</mi><mi>d</mi><mi>e</mi><mi>x</mi></mrow><annotation encoding="application/x-tex">Index</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.69444em; vertical-align: 0em;"></span><span class="mord mathnormal" style="margin-right: 0.07847em;">I</span><span class="mord mathnormal">n</span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathnormal">x</span></span></span></span></span> because there were not any values (or leaves) in that <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><mi>a</mi><mi>l</mi><mi mathvariant="normal">_</mi><mi>t</mi><mi>r</mi><mi>e</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">ral\_tree</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1.00444em; vertical-align: -0.31em;"></span><span class="mord mathnormal" style="margin-right: 0.02778em;">r</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right: 0.01968em;">l</span><span class="mord" style="margin-right: 0.02778em;">_</span><span class="mord mathnormal">t</span><span class="mord mathnormal">ree</span></span></span></span></span>.  In the fourth clause, there are values in the <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><mi>a</mi><msub><mi>l</mi><mi>t</mi></msub><mi>r</mi><mi>e</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">ral_tree</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.84444em; vertical-align: -0.15em;"></span><span class="mord mathnormal" style="margin-right: 0.02778em;">r</span><span class="mord mathnormal">a</span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.01968em;">l</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.280556em;"><span class="" style="top: -2.55em; margin-left: -0.01968em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord mathnormal">ree</span></span></span></span></span> but we haven’t arrived at the <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><mi>a</mi><mi>l</mi><mi mathvariant="normal">_</mi><mi>t</mi><mi>r</mi><mi>e</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">ral\_tree</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1.00444em; vertical-align: -0.31em;"></span><span class="mord mathnormal" style="margin-right: 0.02778em;">r</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right: 0.01968em;">l</span><span class="mord" style="margin-right: 0.02778em;">_</span><span class="mord mathnormal">t</span><span class="mord mathnormal">ree</span></span></span></span></span> for our <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>I</mi><mi>n</mi><mi>d</mi><mi>e</mi><mi>x</mi></mrow><annotation encoding="application/x-tex">Index</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.69444em; vertical-align: 0em;"></span><span class="mord mathnormal" style="margin-right: 0.07847em;">I</span><span class="mord mathnormal">n</span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathnormal">x</span></span></span></span></span> value yet.  In the fifth case, we have found the target <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><mi>a</mi><mi>l</mi><mi mathvariant="normal">_</mi><mi>t</mi><mi>r</mi><mi>e</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">ral\_tree</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1.00444em; vertical-align: -0.31em;"></span><span class="mord mathnormal" style="margin-right: 0.02778em;">r</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right: 0.01968em;">l</span><span class="mord" style="margin-right: 0.02778em;">_</span><span class="mord mathnormal">t</span><span class="mord mathnormal">ree</span></span></span></span></span> and we will use <code>lookup_in_tree</code> to find the specific leaf.</p>
<p>We now have to traverse the <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><mi>a</mi><mi>l</mi><mi mathvariant="normal">_</mi><mi>t</mi><mi>r</mi><mi>e</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">ral\_tree</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1.00444em; vertical-align: -0.31em;"></span><span class="mord mathnormal" style="margin-right: 0.02778em;">r</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right: 0.01968em;">l</span><span class="mord" style="margin-right: 0.02778em;">_</span><span class="mord mathnormal">t</span><span class="mord mathnormal">ree</span></span></span></span></span> to find the leaf associated with our Index value.  In our previous example, the <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>I</mi><mi>n</mi><mi>d</mi><mi>e</mi><mi>x</mi></mrow><annotation encoding="application/x-tex">Index</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.69444em; vertical-align: 0em;"></span><span class="mord mathnormal" style="margin-right: 0.07847em;">I</span><span class="mord mathnormal">n</span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathnormal">x</span></span></span></span></span> was equal to 3 when we found our target <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><mi>a</mi><mi>l</mi><mi mathvariant="normal">_</mi><mi>t</mi><mi>r</mi><mi>e</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">ral\_tree</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1.00444em; vertical-align: -0.31em;"></span><span class="mord mathnormal" style="margin-right: 0.02778em;">r</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right: 0.01968em;">l</span><span class="mord" style="margin-right: 0.02778em;">_</span><span class="mord mathnormal">t</span><span class="mord mathnormal">ree</span></span></span></span></span>.  We will use that <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>I</mi><mi>n</mi><mi>d</mi><mi>e</mi><mi>x</mi></mrow><annotation encoding="application/x-tex">Index</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.69444em; vertical-align: 0em;"></span><span class="mord mathnormal" style="margin-right: 0.07847em;">I</span><span class="mord mathnormal">n</span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathnormal">x</span></span></span></span></span>  to find our leaf.  The process is as follows:</p>
<ol>
<li>If the current node of the <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><mi>a</mi><mi>l</mi><mi mathvariant="normal">_</mi><mi>t</mi><mi>r</mi><mi>e</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">ral\_tree</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1.00444em; vertical-align: -0.31em;"></span><span class="mord mathnormal" style="margin-right: 0.02778em;">r</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right: 0.01968em;">l</span><span class="mord" style="margin-right: 0.02778em;">_</span><span class="mord mathnormal">t</span><span class="mord mathnormal">ree</span></span></span></span></span> is a <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>l</mi><mi>e</mi><mi>a</mi><mi>f</mi></mrow><annotation encoding="application/x-tex">leaf</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span class="mord mathnormal" style="margin-right: 0.01968em;">l</span><span class="mord mathnormal">e</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right: 0.10764em;">f</span></span></span></span></span>, then we have found our value (this is true because we assume that the <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><mi>a</mi><mi>l</mi><mi mathvariant="normal">_</mi><mi>t</mi><mi>r</mi><mi>e</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">ral\_tree</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1.00444em; vertical-align: -0.31em;"></span><span class="mord mathnormal" style="margin-right: 0.02778em;">r</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right: 0.01968em;">l</span><span class="mord" style="margin-right: 0.02778em;">_</span><span class="mord mathnormal">t</span><span class="mord mathnormal">ree</span></span></span></span></span> was created correctly in the first place).</li>
<li>If the current node of the <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><mi>a</mi><mi>l</mi><mi mathvariant="normal">_</mi><mi>t</mi><mi>r</mi><mi>e</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">ral\_tree</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1.00444em; vertical-align: -0.31em;"></span><span class="mord mathnormal" style="margin-right: 0.02778em;">r</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right: 0.01968em;">l</span><span class="mord" style="margin-right: 0.02778em;">_</span><span class="mord mathnormal">t</span><span class="mord mathnormal">ree</span></span></span></span></span> is a <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mi>o</mi><mi>d</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">node</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.69444em; vertical-align: 0em;"></span><span class="mord mathnormal">n</span><span class="mord mathnormal">o</span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span></span></span></span></span>, then we have to either go left or right:
<ul>
<li>If the current <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>I</mi><mi>n</mi><mi>d</mi><mi>e</mi><mi>x</mi></mrow><annotation encoding="application/x-tex">Index</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.69444em; vertical-align: 0em;"></span><span class="mord mathnormal" style="margin-right: 0.07847em;">I</span><span class="mord mathnormal">n</span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathnormal">x</span></span></span></span></span> is <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>&lt;</mo></mrow><annotation encoding="application/x-tex">\lt</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.5782em; vertical-align: -0.0391em;"></span><span class="mrel">&lt;</span></span></span></span></span> the <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi><mi>o</mi><mi>u</mi><mi>n</mi><mi>t</mi><mi mathvariant="normal">/</mi><mn>2</mn></mrow><annotation encoding="application/x-tex">Count / 2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal" style="margin-right: 0.07153em;">C</span><span class="mord mathnormal">o</span><span class="mord mathnormal">u</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span><span class="mord">/2</span></span></span></span></span> (number of leaves on either side of the current node), then keep looking towards the left.</li>
<li>If the current <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi><mi>n</mi><mi>d</mi><mi>e</mi><mi>x</mi></mrow><annotation encoding="application/x-tex">index</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.69444em; vertical-align: 0em;"></span><span class="mord mathnormal">in</span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathnormal">x</span></span></span></span></span> is <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>≥</mo></mrow><annotation encoding="application/x-tex">\geq</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.77194em; vertical-align: -0.13597em;"></span><span class="mrel">≥</span></span></span></span></span> the <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi><mi>o</mi><mi>u</mi><mi>n</mi><mi>t</mi><mi mathvariant="normal">/</mi><mn>2</mn></mrow><annotation encoding="application/x-tex">Count / 2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal" style="margin-right: 0.07153em;">C</span><span class="mord mathnormal">o</span><span class="mord mathnormal">u</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span><span class="mord">/2</span></span></span></span></span>, then keep looking towards the right.  In this case, we need to subtract off <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi><mi>o</mi><mi>u</mi><mi>n</mi><mi>t</mi><mi mathvariant="normal">/</mi><mn>2</mn></mrow><annotation encoding="application/x-tex">Count / 2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal" style="margin-right: 0.07153em;">C</span><span class="mord mathnormal">o</span><span class="mord mathnormal">u</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span><span class="mord">/2</span></span></span></span></span> from the <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>I</mi><mi>n</mi><mi>d</mi><mi>e</mi><mi>x</mi></mrow><annotation encoding="application/x-tex">Index</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.69444em; vertical-align: 0em;"></span><span class="mord mathnormal" style="margin-right: 0.07847em;">I</span><span class="mord mathnormal">n</span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathnormal">x</span></span></span></span></span> because the <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi><mi>o</mi><mi>u</mi><mi>n</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">Count</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord mathnormal" style="margin-right: 0.07153em;">C</span><span class="mord mathnormal">o</span><span class="mord mathnormal">u</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span></span></span></span></span> values of children nodes will be relative to the parent node.</li>
</ul>
</li>
</ol>
<p>The definition and implementation of the <code>lookup_in_tree</code> function based on this process will be left for an exercise.</p>
<p>If we wanted to update a value in the RAL, the process is almost the same as looking up a value.  The <code>update</code> function will be just like the <code>lookup</code> function and the <code>update_in_tree</code> function will be just like the <code>lookup_in_tree</code> function.   The table below shows the differences:</p>

<table>
<thead>
<tr>
<th>lookup</th>
<th>update</th>
<th>lookup_in_tree</th>
<th>update_in_tree</th>
</tr>
</thead>
<tbody>
<tr>
<td>Search for the <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><mi>a</mi><mi>l</mi><mi mathvariant="normal">_</mi><mi>t</mi><mi>r</mi><mi>e</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">ral\_tree</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1.00444em; vertical-align: -0.31em;"></span><span class="mord mathnormal" style="margin-right: 0.02778em;">r</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right: 0.01968em;">l</span><span class="mord" style="margin-right: 0.02778em;">_</span><span class="mord mathnormal">t</span><span class="mord mathnormal">ree</span></span></span></span></span> based on the <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>I</mi><mi>n</mi><mi>d</mi><mi>e</mi><mi>x</mi></mrow><annotation encoding="application/x-tex">Index</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.69444em; vertical-align: 0em;"></span><span class="mord mathnormal" style="margin-right: 0.07847em;">I</span><span class="mord mathnormal">n</span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathnormal">x</span></span></span></span></span>.  When found, return the value returned from <code>lookup_in_tree</code>.</td>
<td>Search for the <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><mi>a</mi><mi>l</mi><mi mathvariant="normal">_</mi><mi>t</mi><mi>r</mi><mi>e</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">ral\_tree</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1.00444em; vertical-align: -0.31em;"></span><span class="mord mathnormal" style="margin-right: 0.02778em;">r</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right: 0.01968em;">l</span><span class="mord" style="margin-right: 0.02778em;">_</span><span class="mord mathnormal">t</span><span class="mord mathnormal">ree</span></span></span></span></span> based on the <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>I</mi><mi>n</mi><mi>d</mi><mi>e</mi><mi>x</mi></mrow><annotation encoding="application/x-tex">Index</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.69444em; vertical-align: 0em;"></span><span class="mord mathnormal" style="margin-right: 0.07847em;">I</span><span class="mord mathnormal">n</span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathnormal">x</span></span></span></span></span>.  Rebuild the RAL list from left to right (like an <code>insert_at</code> function) until the <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><mi>a</mi><mi>l</mi><mi mathvariant="normal">_</mi><mi>t</mi><mi>r</mi><mi>e</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">ral\_tree</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1.00444em; vertical-align: -0.31em;"></span><span class="mord mathnormal" style="margin-right: 0.02778em;">r</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right: 0.01968em;">l</span><span class="mord" style="margin-right: 0.02778em;">_</span><span class="mord mathnormal">t</span><span class="mord mathnormal">ree</span></span></span></span></span> is found.  When found, use the updated <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><mi>a</mi><mi>l</mi><mi mathvariant="normal">_</mi><mi>t</mi><mi>r</mi><mi>e</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">ral\_tree</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1.00444em; vertical-align: -0.31em;"></span><span class="mord mathnormal" style="margin-right: 0.02778em;">r</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right: 0.01968em;">l</span><span class="mord" style="margin-right: 0.02778em;">_</span><span class="mord mathnormal">t</span><span class="mord mathnormal">ree</span></span></span></span></span> returned from <code>update_in_tree</code>.  The remaining RAL list is reused.</td>
<td>Use the <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>I</mi><mi>n</mi><mi>d</mi><mi>e</mi><mi>x</mi></mrow><annotation encoding="application/x-tex">Index</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.69444em; vertical-align: 0em;"></span><span class="mord mathnormal" style="margin-right: 0.07847em;">I</span><span class="mord mathnormal">n</span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathnormal">x</span></span></span></span></span> to traverse the tree left and right until the value is found.  Return the value in the <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>l</mi><mi>e</mi><mi>a</mi><mi>f</mi></mrow><annotation encoding="application/x-tex">leaf</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span class="mord mathnormal" style="margin-right: 0.01968em;">l</span><span class="mord mathnormal">e</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right: 0.10764em;">f</span></span></span></span></span> that was found.</td>
<td>Use the <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>I</mi><mi>n</mi><mi>d</mi><mi>e</mi><mi>x</mi></mrow><annotation encoding="application/x-tex">Index</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.69444em; vertical-align: 0em;"></span><span class="mord mathnormal" style="margin-right: 0.07847em;">I</span><span class="mord mathnormal">n</span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathnormal">x</span></span></span></span></span> to traverse the tree left and right.  Rebuild the tree (in the same way as was done with the Binary Search Tree) starting with the <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>l</mi><mi>e</mi><mi>a</mi><mi>f</mi></mrow><annotation encoding="application/x-tex">leaf</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span class="mord mathnormal" style="margin-right: 0.01968em;">l</span><span class="mord mathnormal">e</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right: 0.10764em;">f</span></span></span></span></span> using the new modified value.</td>
</tr>
</tbody>
</table><p>The definition for <code>update</code> is provided below.  The definition and implementation of the <code>update_in_tree</code> is left as an exercise.</p>
<blockquote>
<p><span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>p</mi><mi>e</mi><mi>c</mi><mtext>&nbsp;&nbsp;</mtext><mi>u</mi><mi>p</mi><mi>d</mi><mi>a</mi><mi>t</mi><mi>e</mi><mo>:</mo><mo>:</mo><mi>i</mi><mi>n</mi><mi>t</mi><mi>e</mi><mi>g</mi><mi>e</mi><mi>r</mi><mtext>&nbsp;&nbsp;</mtext><mi>a</mi><mtext>&nbsp;&nbsp;</mtext><mo stretchy="false">[</mo><mi>r</mi><mi>a</mi><mi>l</mi><mi mathvariant="normal">_</mi><mi>t</mi><mi>r</mi><mi>e</mi><mi>e</mi><mo stretchy="false">]</mo><mo>→</mo><mo stretchy="false">[</mo><mi>r</mi><mi>a</mi><mi>l</mi><mi mathvariant="normal">_</mi><mi>t</mi><mi>r</mi><mi>e</mi><mi>e</mi><mo stretchy="false">]</mo><mi mathvariant="normal">.</mi></mrow><annotation encoding="application/x-tex">spec ~ ~ update:: integer ~ ~ a ~ ~ [ral\_tree] \rightarrow [ral\_tree].</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span class="mord mathnormal">s</span><span class="mord mathnormal">p</span><span class="mord mathnormal">ec</span><span class="mspace nobreak">&nbsp;</span><span class="mspace nobreak">&nbsp;</span><span class="mord mathnormal">u</span><span class="mord mathnormal">p</span><span class="mord mathnormal">d</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">::</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1.06em; vertical-align: -0.31em;"></span><span class="mord mathnormal">in</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right: 0.03588em;">g</span><span class="mord mathnormal" style="margin-right: 0.02778em;">er</span><span class="mspace nobreak">&nbsp;</span><span class="mspace nobreak">&nbsp;</span><span class="mord mathnormal">a</span><span class="mspace nobreak">&nbsp;</span><span class="mspace nobreak">&nbsp;</span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right: 0.02778em;">r</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right: 0.01968em;">l</span><span class="mord" style="margin-right: 0.02778em;">_</span><span class="mord mathnormal">t</span><span class="mord mathnormal">ree</span><span class="mclose">]</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1.06em; vertical-align: -0.31em;"></span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right: 0.02778em;">r</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right: 0.01968em;">l</span><span class="mord" style="margin-right: 0.02778em;">_</span><span class="mord mathnormal">t</span><span class="mord mathnormal">ree</span><span class="mclose">]</span><span class="mord">.</span></span></span></span></span></p>
<p><span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mi>e</mi><mi>f</mi><mtext>&nbsp;&nbsp;</mtext><mi>u</mi><mi>p</mi><mi>d</mi><mi>a</mi><mi>t</mi><mi>e</mi><mo>:</mo><mo>:</mo><mi>I</mi><mi>n</mi><mi>d</mi><mi>e</mi><mi>x</mi><mtext>&nbsp;&nbsp;</mtext><mi>V</mi><mi>a</mi><mi>l</mi><mi>u</mi><mi>e</mi><mtext>&nbsp;&nbsp;</mtext><mi>R</mi><mi>A</mi><mi>L</mi><mo>→</mo><mi>R</mi><mi>A</mi><mi>L</mi><mtext>&nbsp;&nbsp;when&nbsp;&nbsp;</mtext><mi>I</mi><mi>n</mi><mi>d</mi><mi>e</mi><mi>x</mi><mo>&lt;</mo><mn>0</mn><mo separator="true">;</mo></mrow><annotation encoding="application/x-tex">de\mathit{f} ~ ~ update:: Index ~ ~ Value ~ ~ RAL \rightarrow RAL ~ ~ \text{when} ~ ~ Index \lt 0;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathit">f</span><span class="mspace nobreak">&nbsp;</span><span class="mspace nobreak">&nbsp;</span><span class="mord mathnormal">u</span><span class="mord mathnormal">p</span><span class="mord mathnormal">d</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">::</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.69444em; vertical-align: 0em;"></span><span class="mord mathnormal" style="margin-right: 0.07847em;">I</span><span class="mord mathnormal">n</span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathnormal">x</span><span class="mspace nobreak">&nbsp;</span><span class="mspace nobreak">&nbsp;</span><span class="mord mathnormal">Va</span><span class="mord mathnormal" style="margin-right: 0.01968em;">l</span><span class="mord mathnormal">u</span><span class="mord mathnormal">e</span><span class="mspace nobreak">&nbsp;</span><span class="mspace nobreak">&nbsp;</span><span class="mord mathnormal" style="margin-right: 0.00773em;">R</span><span class="mord mathnormal">A</span><span class="mord mathnormal">L</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.73354em; vertical-align: -0.0391em;"></span><span class="mord mathnormal" style="margin-right: 0.00773em;">R</span><span class="mord mathnormal">A</span><span class="mord mathnormal">L</span><span class="mspace nobreak">&nbsp;</span><span class="mspace nobreak">&nbsp;</span><span class="mord text"><span class="mord">when</span></span><span class="mspace nobreak">&nbsp;</span><span class="mspace nobreak">&nbsp;</span><span class="mord mathnormal" style="margin-right: 0.07847em;">I</span><span class="mord mathnormal">n</span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.83888em; vertical-align: -0.19444em;"></span><span class="mord">0</span><span class="mpunct">;</span></span></span></span></span><br>
<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mi>e</mi><mi>f</mi><mtext>&nbsp;&nbsp;</mtext><mi>u</mi><mi>p</mi><mi>d</mi><mi>a</mi><mi>t</mi><mi>e</mi><mo>:</mo><mo>:</mo><mi>I</mi><mi>n</mi><mi>d</mi><mi>e</mi><mi>x</mi><mtext>&nbsp;&nbsp;</mtext><mi>V</mi><mi>a</mi><mi>l</mi><mi>u</mi><mi>e</mi><mtext>&nbsp;&nbsp;</mtext><mo stretchy="false">[</mo><mo stretchy="false">]</mo><mo>→</mo><mo stretchy="false">[</mo><mo stretchy="false">]</mo><mo separator="true">;</mo></mrow><annotation encoding="application/x-tex">de\mathit{f} ~ ~ update:: Index ~ ~ Value ~ ~ [] \rightarrow [];</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathit">f</span><span class="mspace nobreak">&nbsp;</span><span class="mspace nobreak">&nbsp;</span><span class="mord mathnormal">u</span><span class="mord mathnormal">p</span><span class="mord mathnormal">d</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">::</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal" style="margin-right: 0.07847em;">I</span><span class="mord mathnormal">n</span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathnormal">x</span><span class="mspace nobreak">&nbsp;</span><span class="mspace nobreak">&nbsp;</span><span class="mord mathnormal">Va</span><span class="mord mathnormal" style="margin-right: 0.01968em;">l</span><span class="mord mathnormal">u</span><span class="mord mathnormal">e</span><span class="mspace nobreak">&nbsp;</span><span class="mspace nobreak">&nbsp;</span><span class="mopen">[</span><span class="mclose">]</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">[</span><span class="mclose">]</span><span class="mpunct">;</span></span></span></span></span><br>
<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mi>e</mi><mi>f</mi><mtext>&nbsp;&nbsp;</mtext><mi>u</mi><mi>p</mi><mi>d</mi><mi>a</mi><mi>t</mi><mi>e</mi><mo>:</mo><mo>:</mo><mi>I</mi><mi>n</mi><mi>d</mi><mi>e</mi><mi>x</mi><mtext>&nbsp;&nbsp;</mtext><mi>V</mi><mi>a</mi><mi>l</mi><mi>u</mi><mi>e</mi><mtext>&nbsp;&nbsp;</mtext><mo stretchy="false">[</mo><mi>n</mi><mi>i</mi><mi>l</mi><mi mathvariant="normal">∣</mi><mi>R</mi><mi>e</mi><mi>s</mi><mi>t</mi><mi mathvariant="normal">_</mi><mi>T</mi><mi>r</mi><mi>e</mi><mi>e</mi><mi>s</mi><mo stretchy="false">]</mo><mo>→</mo><mo stretchy="false">(</mo><mi>u</mi><mi>p</mi><mi>d</mi><mi>a</mi><mi>t</mi><mi>e</mi><mtext>&nbsp;&nbsp;</mtext><mi>I</mi><mi>n</mi><mi>d</mi><mi>e</mi><mi>x</mi><mtext>&nbsp;&nbsp;</mtext><mi>V</mi><mi>a</mi><mi>l</mi><mi>u</mi><mi>e</mi><mtext>&nbsp;&nbsp;</mtext><mi>R</mi><mi>e</mi><mi>s</mi><mi>t</mi><mi mathvariant="normal">_</mi><mi>T</mi><mi>r</mi><mi>e</mi><mi>e</mi><mi>s</mi><mo stretchy="false">)</mo><mo separator="true">;</mo></mrow><annotation encoding="application/x-tex">de\mathit{f} ~ ~ update:: Index ~ ~ Value ~ ~ [nil|Rest\_Trees] \rightarrow (update ~ ~ Index ~ ~ Value ~ ~ Rest\_Trees);</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathit">f</span><span class="mspace nobreak">&nbsp;</span><span class="mspace nobreak">&nbsp;</span><span class="mord mathnormal">u</span><span class="mord mathnormal">p</span><span class="mord mathnormal">d</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">::</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1.06em; vertical-align: -0.31em;"></span><span class="mord mathnormal" style="margin-right: 0.07847em;">I</span><span class="mord mathnormal">n</span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathnormal">x</span><span class="mspace nobreak">&nbsp;</span><span class="mspace nobreak">&nbsp;</span><span class="mord mathnormal">Va</span><span class="mord mathnormal" style="margin-right: 0.01968em;">l</span><span class="mord mathnormal">u</span><span class="mord mathnormal">e</span><span class="mspace nobreak">&nbsp;</span><span class="mspace nobreak">&nbsp;</span><span class="mopen">[</span><span class="mord mathnormal">ni</span><span class="mord mathnormal" style="margin-right: 0.01968em;">l</span><span class="mord">∣</span><span class="mord mathnormal" style="margin-right: 0.00773em;">R</span><span class="mord mathnormal">es</span><span class="mord mathnormal">t</span><span class="mord" style="margin-right: 0.02778em;">_</span><span class="mord mathnormal" style="margin-right: 0.13889em;">T</span><span class="mord mathnormal">rees</span><span class="mclose">]</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1.06em; vertical-align: -0.31em;"></span><span class="mopen">(</span><span class="mord mathnormal">u</span><span class="mord mathnormal">p</span><span class="mord mathnormal">d</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span><span class="mspace nobreak">&nbsp;</span><span class="mspace nobreak">&nbsp;</span><span class="mord mathnormal" style="margin-right: 0.07847em;">I</span><span class="mord mathnormal">n</span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathnormal">x</span><span class="mspace nobreak">&nbsp;</span><span class="mspace nobreak">&nbsp;</span><span class="mord mathnormal">Va</span><span class="mord mathnormal" style="margin-right: 0.01968em;">l</span><span class="mord mathnormal">u</span><span class="mord mathnormal">e</span><span class="mspace nobreak">&nbsp;</span><span class="mspace nobreak">&nbsp;</span><span class="mord mathnormal" style="margin-right: 0.00773em;">R</span><span class="mord mathnormal">es</span><span class="mord mathnormal">t</span><span class="mord" style="margin-right: 0.02778em;">_</span><span class="mord mathnormal" style="margin-right: 0.13889em;">T</span><span class="mord mathnormal">rees</span><span class="mclose">)</span><span class="mpunct">;</span></span></span></span></span><br>
<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mi>e</mi><mi>f</mi><mtext>&nbsp;&nbsp;</mtext><mi>u</mi><mi>p</mi><mi>d</mi><mi>a</mi><mi>t</mi><mi>e</mi><mo>:</mo><mo>:</mo><mi>I</mi><mi>n</mi><mi>d</mi><mi>e</mi><mi>x</mi><mtext>&nbsp;&nbsp;</mtext><mi>V</mi><mi>a</mi><mi>l</mi><mi>u</mi><mi>e</mi><mtext>&nbsp;&nbsp;</mtext><mo stretchy="false">[</mo><mi>T</mi><mi>r</mi><mi>e</mi><mi>e</mi><mi mathvariant="normal">∣</mi><mi>R</mi><mi>e</mi><mi>s</mi><mi>t</mi><mi mathvariant="normal">_</mi><mi>T</mi><mi>r</mi><mi>e</mi><mi>e</mi><mi>s</mi><mo stretchy="false">]</mo><mo>→</mo><mo stretchy="false">[</mo><mi>T</mi><mi>r</mi><mi>e</mi><mi>e</mi><mi mathvariant="normal">∣</mi><mo stretchy="false">(</mo><mi>u</mi><mi>p</mi><mi>d</mi><mi>a</mi><mi>t</mi><mi>e</mi><mtext>&nbsp;&nbsp;</mtext><mi>I</mi><mi>n</mi><mi>d</mi><mi>e</mi><mi>x</mi><mo>−</mo><mo stretchy="false">(</mo><mi>c</mi><mi>o</mi><mi>u</mi><mi>n</mi><mi>t</mi><mtext>&nbsp;&nbsp;</mtext><mi>T</mi><mi>r</mi><mi>e</mi><mi>e</mi><mo stretchy="false">)</mo><mtext>&nbsp;&nbsp;</mtext><mi>V</mi><mi>a</mi><mi>l</mi><mi>u</mi><mi>e</mi><mtext>&nbsp;&nbsp;</mtext><mi>R</mi><mi>e</mi><mi>s</mi><mi>t</mi><mi mathvariant="normal">_</mi><mi>T</mi><mi>r</mi><mi>e</mi><mi>e</mi><mi>s</mi><mo stretchy="false">)</mo><mo stretchy="false">]</mo><mtext>&nbsp;&nbsp;when&nbsp;&nbsp;</mtext><mi>I</mi><mi>n</mi><mi>d</mi><mi>e</mi><mi>x</mi><mo>≥</mo><mo stretchy="false">(</mo><mi>c</mi><mi>o</mi><mi>u</mi><mi>n</mi><mi>t</mi><mtext>&nbsp;&nbsp;</mtext><mi>T</mi><mi>r</mi><mi>e</mi><mi>e</mi><mo stretchy="false">)</mo><mo separator="true">;</mo></mrow><annotation encoding="application/x-tex">de\mathit{f} ~ ~ update:: Index ~ ~ Value ~ ~ [Tree|Rest\_Trees] \rightarrow [Tree|(update ~ ~ Index-(count ~ ~ Tree) ~ ~ Value ~ ~ Rest\_Trees)] ~ ~ \text{when} ~ ~ Index \geq (count ~ ~ Tree);</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathit">f</span><span class="mspace nobreak">&nbsp;</span><span class="mspace nobreak">&nbsp;</span><span class="mord mathnormal">u</span><span class="mord mathnormal">p</span><span class="mord mathnormal">d</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">::</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1.06em; vertical-align: -0.31em;"></span><span class="mord mathnormal" style="margin-right: 0.07847em;">I</span><span class="mord mathnormal">n</span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathnormal">x</span><span class="mspace nobreak">&nbsp;</span><span class="mspace nobreak">&nbsp;</span><span class="mord mathnormal">Va</span><span class="mord mathnormal" style="margin-right: 0.01968em;">l</span><span class="mord mathnormal">u</span><span class="mord mathnormal">e</span><span class="mspace nobreak">&nbsp;</span><span class="mspace nobreak">&nbsp;</span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right: 0.13889em;">T</span><span class="mord mathnormal">ree</span><span class="mord">∣</span><span class="mord mathnormal" style="margin-right: 0.00773em;">R</span><span class="mord mathnormal">es</span><span class="mord mathnormal">t</span><span class="mord" style="margin-right: 0.02778em;">_</span><span class="mord mathnormal" style="margin-right: 0.13889em;">T</span><span class="mord mathnormal">rees</span><span class="mclose">]</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right: 0.13889em;">T</span><span class="mord mathnormal">ree</span><span class="mord">∣</span><span class="mopen">(</span><span class="mord mathnormal">u</span><span class="mord mathnormal">p</span><span class="mord mathnormal">d</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span><span class="mspace nobreak">&nbsp;</span><span class="mspace nobreak">&nbsp;</span><span class="mord mathnormal" style="margin-right: 0.07847em;">I</span><span class="mord mathnormal">n</span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1.06em; vertical-align: -0.31em;"></span><span class="mopen">(</span><span class="mord mathnormal">co</span><span class="mord mathnormal">u</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span><span class="mspace nobreak">&nbsp;</span><span class="mspace nobreak">&nbsp;</span><span class="mord mathnormal" style="margin-right: 0.13889em;">T</span><span class="mord mathnormal">ree</span><span class="mclose">)</span><span class="mspace nobreak">&nbsp;</span><span class="mspace nobreak">&nbsp;</span><span class="mord mathnormal">Va</span><span class="mord mathnormal" style="margin-right: 0.01968em;">l</span><span class="mord mathnormal">u</span><span class="mord mathnormal">e</span><span class="mspace nobreak">&nbsp;</span><span class="mspace nobreak">&nbsp;</span><span class="mord mathnormal" style="margin-right: 0.00773em;">R</span><span class="mord mathnormal">es</span><span class="mord mathnormal">t</span><span class="mord" style="margin-right: 0.02778em;">_</span><span class="mord mathnormal" style="margin-right: 0.13889em;">T</span><span class="mord mathnormal">rees</span><span class="mclose">)]</span><span class="mspace nobreak">&nbsp;</span><span class="mspace nobreak">&nbsp;</span><span class="mord text"><span class="mord">when</span></span><span class="mspace nobreak">&nbsp;</span><span class="mspace nobreak">&nbsp;</span><span class="mord mathnormal" style="margin-right: 0.07847em;">I</span><span class="mord mathnormal">n</span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">≥</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">co</span><span class="mord mathnormal">u</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span><span class="mspace nobreak">&nbsp;</span><span class="mspace nobreak">&nbsp;</span><span class="mord mathnormal" style="margin-right: 0.13889em;">T</span><span class="mord mathnormal">ree</span><span class="mclose">)</span><span class="mpunct">;</span></span></span></span></span><br>
<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mi>e</mi><mi>f</mi><mtext>&nbsp;&nbsp;</mtext><mi>u</mi><mi>p</mi><mi>d</mi><mi>a</mi><mi>t</mi><mi>e</mi><mo>:</mo><mo>:</mo><mi>I</mi><mi>n</mi><mi>d</mi><mi>e</mi><mi>x</mi><mtext>&nbsp;&nbsp;</mtext><mi>V</mi><mi>a</mi><mi>l</mi><mi>u</mi><mi>e</mi><mtext>&nbsp;&nbsp;</mtext><mo stretchy="false">[</mo><mi>T</mi><mi>r</mi><mi>e</mi><mi>e</mi><mi mathvariant="normal">∣</mi><mi>R</mi><mi>e</mi><mi>s</mi><mi>t</mi><mi mathvariant="normal">_</mi><mi>T</mi><mi>r</mi><mi>e</mi><mi>e</mi><mi>s</mi><mo stretchy="false">]</mo><mo>→</mo><mo stretchy="false">[</mo><mo stretchy="false">(</mo><mi>u</mi><mi>p</mi><mi>d</mi><mi>a</mi><mi>t</mi><mi>e</mi><mi mathvariant="normal">_</mi><mi>i</mi><mi>n</mi><mi mathvariant="normal">_</mi><mi>t</mi><mi>r</mi><mi>e</mi><mi>e</mi><mtext>&nbsp;&nbsp;</mtext><mi>I</mi><mi>n</mi><mi>d</mi><mi>e</mi><mi>x</mi><mtext>&nbsp;&nbsp;</mtext><mi>V</mi><mi>a</mi><mi>l</mi><mi>u</mi><mi>e</mi><mtext>&nbsp;&nbsp;</mtext><mi>T</mi><mi>r</mi><mi>e</mi><mi>e</mi><mo stretchy="false">)</mo><mi mathvariant="normal">∣</mi><mi>R</mi><mi>e</mi><mi>s</mi><mi>t</mi><mi mathvariant="normal">_</mi><mi>T</mi><mi>r</mi><mi>e</mi><mi>e</mi><mi>s</mi><mo stretchy="false">]</mo><mi mathvariant="normal">.</mi></mrow><annotation encoding="application/x-tex">de\mathit{f} ~ ~ update:: Index ~ ~ Value ~ ~ [Tree|Rest\_Trees] \rightarrow [(update\_in\_tree ~ ~ Index ~ ~ Value ~ ~ Tree)|Rest\_Trees].</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathit">f</span><span class="mspace nobreak">&nbsp;</span><span class="mspace nobreak">&nbsp;</span><span class="mord mathnormal">u</span><span class="mord mathnormal">p</span><span class="mord mathnormal">d</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">::</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1.06em; vertical-align: -0.31em;"></span><span class="mord mathnormal" style="margin-right: 0.07847em;">I</span><span class="mord mathnormal">n</span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathnormal">x</span><span class="mspace nobreak">&nbsp;</span><span class="mspace nobreak">&nbsp;</span><span class="mord mathnormal">Va</span><span class="mord mathnormal" style="margin-right: 0.01968em;">l</span><span class="mord mathnormal">u</span><span class="mord mathnormal">e</span><span class="mspace nobreak">&nbsp;</span><span class="mspace nobreak">&nbsp;</span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right: 0.13889em;">T</span><span class="mord mathnormal">ree</span><span class="mord">∣</span><span class="mord mathnormal" style="margin-right: 0.00773em;">R</span><span class="mord mathnormal">es</span><span class="mord mathnormal">t</span><span class="mord" style="margin-right: 0.02778em;">_</span><span class="mord mathnormal" style="margin-right: 0.13889em;">T</span><span class="mord mathnormal">rees</span><span class="mclose">]</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1.06em; vertical-align: -0.31em;"></span><span class="mopen">[(</span><span class="mord mathnormal">u</span><span class="mord mathnormal">p</span><span class="mord mathnormal">d</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span><span class="mord" style="margin-right: 0.02778em;">_</span><span class="mord mathnormal">in</span><span class="mord" style="margin-right: 0.02778em;">_</span><span class="mord mathnormal">t</span><span class="mord mathnormal">ree</span><span class="mspace nobreak">&nbsp;</span><span class="mspace nobreak">&nbsp;</span><span class="mord mathnormal" style="margin-right: 0.07847em;">I</span><span class="mord mathnormal">n</span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathnormal">x</span><span class="mspace nobreak">&nbsp;</span><span class="mspace nobreak">&nbsp;</span><span class="mord mathnormal">Va</span><span class="mord mathnormal" style="margin-right: 0.01968em;">l</span><span class="mord mathnormal">u</span><span class="mord mathnormal">e</span><span class="mspace nobreak">&nbsp;</span><span class="mspace nobreak">&nbsp;</span><span class="mord mathnormal" style="margin-right: 0.13889em;">T</span><span class="mord mathnormal">ree</span><span class="mclose">)</span><span class="mord">∣</span><span class="mord mathnormal" style="margin-right: 0.00773em;">R</span><span class="mord mathnormal">es</span><span class="mord mathnormal">t</span><span class="mord" style="margin-right: 0.02778em;">_</span><span class="mord mathnormal" style="margin-right: 0.13889em;">T</span><span class="mord mathnormal">rees</span><span class="mclose">]</span><span class="mord">.</span></span></span></span></span></p>
</blockquote>
<p>Notice that an additional difference is that the <code>update</code>  function will return the original RAL if the index is incorrect.</p>
<h2 id="problem-set-2">Problem Set 2</h2>
<ol>
<li>Implement <code>lookup</code> and <code>lookup_in_tree</code> based on the descriptions above.  Use the test code provided to verify your implementation.</li>
<li>Implement <code>update</code> and <code>update_in_tree</code> based on the descriptions above.  Use the test code provided to verify your implementation.</li>
</ol>
<h2 id="part-3---performance">Part 3 - Performance</h2>
<p>The cost of traversing the RAL list will be O(log n) and cost of traversing a <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><mi>a</mi><mi>l</mi><mi mathvariant="normal">_</mi><mi>t</mi><mi>r</mi><mi>e</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">ral\_tree</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1.00444em; vertical-align: -0.31em;"></span><span class="mord mathnormal" style="margin-right: 0.02778em;">r</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right: 0.01968em;">l</span><span class="mord" style="margin-right: 0.02778em;">_</span><span class="mord mathnormal">t</span><span class="mord mathnormal">ree</span></span></span></span></span> will also be O(log n) which means that our <code>lookup</code> and <code>update</code> functions are O(log n).  If we used a standard list, we would need to recursively search from left to right to find the desired index which would result in O(n).  To demonstrate this, you can use the <code>nth</code> function provided by Erlang which will provide the value at a specified index in a list.  Note that the <code>nth</code> function treats the first elements as Index 1 instead of 0 like our RAL.</p>
<p>Using the same <code>start_perf</code> and <code>stop_perf</code> used in previous lessons, we can measure the time it takes to access the last item in a very large 1,000,000 item Erlang list.</p>
<pre class=" language-erlang"><code class="prism  language-erlang"><span class="token function">start_perf</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span>
	<span class="token atom">eprof</span><span class="token punctuation">:</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token atom">eprof</span><span class="token punctuation">:</span><span class="token function">start_profiling</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token function">self</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>

<span class="token function">stop_perf</span><span class="token punctuation">(</span><span class="token variable">Title</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span>
	<span class="token atom">io</span><span class="token punctuation">:</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"Perf (~p): ~n"</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token variable">Title</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token atom">eprof</span><span class="token punctuation">:</span><span class="token function">stop_profiling</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token atom">eprof</span><span class="token punctuation">:</span><span class="token function">analyze</span><span class="token punctuation">(</span><span class="token atom">total</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token atom">eprof</span><span class="token punctuation">:</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span>
	<span class="token variable">List</span> <span class="token operator">=</span> <span class="token atom">lists</span><span class="token punctuation">:</span><span class="token function">seq</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">999999</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token function">start_perf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token number">999999</span> <span class="token operator">=</span> <span class="token atom">lists</span><span class="token punctuation">:</span><span class="token function">nth</span><span class="token punctuation">(</span><span class="token number">1000000</span><span class="token punctuation">,</span><span class="token variable">List</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token function">stop_perf</span><span class="token punctuation">(</span><span class="token string">"list lookup last one"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</code></pre>
<p>The comparison of accessing the last item in a RAL with the last item in an Erlang list is left for an exercise.</p>
<h2 id="problem-set-3">Problem Set 3</h2>
<ol>
<li>Create a RAL with 1,000,000 items by using a <code>foldl</code> and the <code>prepend</code> function.  Using <code>start_perf</code> and <code>stop_perf</code> (provided in the test code), compare the time for looking up index 999,999 (the last item) in both the Erlang List and the RAL.  Discuss your observations in comments within your code.  Note both the CALLS and the TIME columns when comparing the performance.</li>
</ol>

    </div>
  </div>
</body>

</html>
